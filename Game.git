<!doctype html>
<html lang="ru">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no" />
<title>–°–∏–º—É–ª—è—Ç–æ—Ä –£–¥–∞—á–∏ ‚Äî –†–µ–ª–∏–∑–Ω—ã–π —Ñ–µ—Å—Ç–∏–≤–∞–ª—å</title>
<style>
:root{
  --bg1:#071029; --bg2:#0b2638; --card:#0f2a3a; --accent:#ffd166;
  --muted:#9fb3c8; --glass: rgba(255,255,255,0.03);
}
*{box-sizing:border-box}
html,body{height:100%;margin:0;font-family:Inter,Segoe UI,Roboto,Arial,sans-serif;background:linear-gradient(180deg,var(--bg1),var(--bg2));color:#e6f1fb}
.container{max-width:100%;margin:0;padding:8px;display:grid;grid-template-columns:1fr;gap:8px}
.header{display:flex;align-items:center;gap:8px}
.logo svg{width:48px;height:48px}
.title{font-size:18px;font-weight:700}
.top-stats{margin-left:auto;display:flex;gap:6px;align-items:center}
.stat{background:var(--glass);padding:6px 8px;border-radius:6px;min-width:70px;text-align:center}
.stat .v{font-size:14px;font-weight:700;color:var(--accent)}
.play-area{background:linear-gradient(180deg, rgba(255,255,255,0.01), rgba(255,255,255,0.01));padding:8px;border-radius:10px;min-height:400px;display:flex;flex-direction:column;gap:6px;position:relative;overflow:hidden}
.controls{display:flex;gap:6px;align-items:center;flex-wrap:wrap}
.btn-primary{
  flex:1;
  min-width:100px;
  padding:8px 12px;
  border-radius:8px;
  border:0;
  background:linear-gradient(90deg,#1fa2ff,#2ea3ff);
  font-size:14px;
  cursor:pointer;
  box-shadow:0 4px 12px rgba(0,0,0,0.3);
  white-space:normal;
  text-align:center;
}
.btn-ghost{padding:6px 8px;border-radius:6px;border:1px solid rgba(255,255,255,0.06);background:transparent;color:#e6f1fb;cursor:pointer}
.feed{background:linear-gradient(180deg, rgba(255,255,255,0.01), rgba(255,255,255,0.01));padding:6px;border-radius:8px;display:flex;flex-direction:column;gap:4px;min-height:200px;overflow:auto;font-size:12px}
.feed .item{display:flex;gap:6px;align-items:center;padding:6px;border-radius:6px;background:rgba(255,255,255,0.015)}
/* –ù–û–í–û–ï: –º–µ–Ω—é –∞–ø–≥—Ä–µ–π–¥–æ–≤ –ù–ï–ü–†–û–ó–†–ê–ß–ù–û–ï */
.side-panel{
  background:var(--card); /* –ü–æ–ª–Ω–æ—Å—Ç—å—é –Ω–µ–ø—Ä–æ–∑—Ä–∞—á–Ω—ã–π —Ñ–æ–Ω */
  padding:8px;
  border-radius:10px;
  min-height:400px;
  display:flex;
  flex-direction:column;
  gap:6px;
  box-shadow: 0 4px 12px rgba(0,0,0,0.2); /* –î–æ–±–∞–≤–ª–µ–Ω–∞ —Ç–µ–Ω—å –¥–ª—è –≥–ª—É–±–∏–Ω—ã */
}
.section{
  background:rgba(255,255,255,0.05); /* –°–ª–µ–≥–∫–∞ –ø—Ä–æ–∑—Ä–∞—á–Ω—ã–µ —Å–µ–∫—Ü–∏–∏ –≤–Ω—É—Ç—Ä–∏ */
  padding:6px;
  border-radius:8px;
}
.upgrades-grid{display:grid;grid-template-columns:1fr;gap:6px;max-height:300px;overflow:auto}
.upgrade-card{
  background:rgba(255,255,255,0.08); /* –°–ª–µ–≥–∫–∞ –ø—Ä–æ–∑—Ä–∞—á–Ω—ã–µ –∫–∞—Ä—Ç–æ—á–∫–∏ */
  padding:6px;
  border-radius:6px;
  border:1px solid rgba(255,255,255,0.08);
  display:flex;
  flex-direction:column;
  gap:4px;
  font-size:12px;
}
.upgrade-top{display:flex;align-items:center;gap:6px}
.upgrade-name{font-weight:700}
.upgrade-meta{font-size:10px;color:var(--muted)}
.upgrade-actions{display:flex;gap:4px;align-items:center}
.action-btn{padding:4px 6px;border-radius:4px;border:0;cursor:pointer}
.open-btn{background:linear-gradient(180deg,var(--accent),#ffb84d);color:#000;font-weight:700}
.progress{height:6px;background:rgba(255,255,255,0.08);border-radius:99px;overflow:hidden}
.progress > i{display:block;height:100%;background:linear-gradient(90deg,#ffd166,#ffb84d);width:0%}
.inv-list{display:flex;flex-direction:column;gap:4px;max-height:120px;overflow:auto}
.small{font-size:10px;color:var(--muted)}
.footer{text-align:center;color:var(--muted);font-size:10px}
.toast{position:fixed;left:50%;transform:translateX(-50%);bottom:12px;background:#072b3a;padding:6px 10px;border-radius:999px;border:1px solid rgba(255,255,255,0.03);display:none;z-index:9999}
.coin-fx{position:absolute;border-radius:50%;width:16px;height:16px;background:linear-gradient(180deg,#ffd166,#ffa500);box-shadow:0 1px 4px rgba(0,0,0,0.4);pointer-events:none;transform:translate(-50%,-50%);transition:transform 650ms cubic-bezier(.2,.8,.2,1),opacity 650ms;}
.quest-row{display:flex;justify-content:space-between;align-items:center;gap:6px;padding:4px 6px;border-radius:6px;background:rgba(255,255,255,0.02)}
.event-btn{background:linear-gradient(180deg,#ff7a5a,#ffb84d);color:#000;font-weight:700;padding:8px;border-radius:6px;border:none;cursor:pointer}
/* –ù–û–í–û–ï: —Å—Ç–∏–ª–∏ –¥–ª—è —ç–ø–∏—á–Ω–æ–≥–æ –∏–≤–µ–Ω—Ç-–º–∞–≥–∞–∑–∏–Ω–∞ */
.event-shop-grid{display:grid;grid-template-columns:1fr;gap:6px}
.event-shop-item{
  background:rgba(255,255,255,0.08);
  padding:8px;
  border-radius:8px;
  border:1px solid rgba(255,255,255,0.08);
  display:flex;
  flex-direction:column;
  gap:4px;
  font-size:12px;
  position:relative;
  overflow:hidden;
}
.event-shop-item::before{
  content:'';
  position:absolute;
  top:0;
  left:0;
  right:0;
  height:2px;
  background:linear-gradient(90deg,#ff5a7a,#ff7ec7);
}
.event-shop-item .name{
  font-weight:700;
  color:#ff7ec7;
  font-size:14px;
}
.event-shop-item .desc{
  color:var(--muted);
  font-size:10px;
  line-height:1.3;
}
.event-shop-item .cost{
  display:flex;
  align-items:center;
  gap:4px;
  font-weight:700;
  color:#ffd166;
}
.event-shop-item .sold{
  opacity:0.4;
  filter:blur(1px);
}
.event-shop-item .epic-tag{
  position:absolute;
  top:6px;
  right:6px;
  background:linear-gradient(90deg,#ff5a7a,#ff7ec7);
  color:#fff;
  font-size:9px;
  padding:1px 4px;
  border-radius:99px;
  font-weight:700;
}
/* –ù–û–í–û–ï: —Å—Ç–∏–ª–∏ –¥–ª—è –º–∞–≥–∞–∑–∏–Ω–∞ –ø–∏—Ç–æ–º—Ü–µ–≤ */
.pets-shop-grid{display:grid;grid-template-columns:1fr;gap:6px}
.pet-shop-item{
  background:rgba(255,255,255,0.08);
  padding:8px;
  border-radius:8px;
  border:1px solid rgba(255,255,255,0.08);
  display:flex;
  flex-direction:column;
  gap:4px;
  font-size:12px;
  position:relative;
  overflow:hidden;
}
.pet-shop-item::before{
  content:'';
  position:absolute;
  top:0;
  left:0;
  right:0;
  height:2px;
}
.pet-shop-item .pet-icon{
  width:32px;
  height:32px;
  border-radius:50%;
  display:flex;
  align-items:center;
  justify-content:center;
  margin:0 auto;
  font-size:16px;
}
.pet-shop-item .name{
  font-weight:700;
  text-align:center;
}
.pet-shop-item .rarity{
  text-align:center;
  font-size:10px;
  color:var(--muted);
}
.pet-shop-item .cost{
  display:flex;
  align-items:center;
  justify-content:center;
  gap:4px;
  font-weight:700;
  color:#ffd166;
}
.pet-shop-item .hatched{
  opacity:0.4;
}
.common::before{background:#7fd3ff}
.rare::before{background:#ffd166}
.epic::before{background:#ff7ec7}
.legendary::before{background:#ff5a7a}
.common .pet-icon{background:#7fd3ff22}
.rare .pet-icon{background:#ffd16622}
.epic .pet-icon{background:#ff7ec722}
.legendary .pet-icon{background:#ff5a7a22}
/* –ù–û–í–û–ï: —Å—Ç–∏–ª–∏ –¥–ª—è –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ –ø–∏—Ç–æ–º—Ü–µ–≤ */
.pet-modal{
  position:fixed;
  top:0;
  left:0;
  width:100%;
  height:100%;
  background:rgba(0,0,0,0.7);
  display:flex;
  align-items:center;
  justify-content:center;
  z-index:10000;
  display:none;
}
.pet-modal-content{
  background:var(--card);
  width:90%;
  max-width:320px;
  border-radius:10px;
  overflow:hidden;
  box-shadow:0 8px 24px rgba(0,0,0,0.5);
}
.pet-modal-header{
  padding:10px;
  background:rgba(255,255,255,0.05);
  display:flex;
  justify-content:space-between;
  align-items:center;
}
.pet-modal-body{
  padding:10px;
  max-height:50vh;
  overflow:auto;
}
.pet-modal-footer{
  padding:10px;
  display:flex;
  gap:6px;
  background:rgba(255,255,255,0.05);
}
.pet-slot{
  width:48px;
  height:48px;
  border-radius:50%;
  display:flex;
  align-items:center;
  justify-content:center;
  font-size:16px;
  border:1px dashed rgba(255,255,255,0.1);
  margin:0 3px;
}
.pet-slot.selected{
  border-color:var(--accent);
  box-shadow:0 0 8px rgba(255,213,102,0.3);
}
.pet-slot .remove{
  position:absolute;
  top:-4px;
  right:-4px;
  width:16px;
  height:16px;
  border-radius:50%;
  background:#ff5a7a;
  color:#fff;
  font-size:8px;
  display:flex;
  align-items:center;
  justify-content:center;
  cursor:pointer;
}
/* –ù–û–í–û–ï: —Å—Ç–∏–ª–∏ –¥–ª—è –Ω–∞—Å—Ç—Ä–æ–µ–∫ */
.settings-panel{display:flex;flex-direction:column;gap:4px}
.lang-selector{display:flex;gap:4px}
.lang-btn{padding:4px 6px;border-radius:4px;border:1px solid rgba(255,255,255,0.06);background:transparent;color:#e6f1fb;cursor:pointer;flex:1}
.lang-btn.active{background:rgba(255,255,255,0.05);border-color:var(--accent)}

/* –ù–û–í–û–ï: —Å—Ç–∏–ª–∏ –¥–ª—è –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–π */
.achievements-section{
  display:flex;
  flex-direction:column;
  gap:4px;
}
.achievement-item{
  padding:4px;
  border-radius:4px;
  background:rgba(255,255,255,0.03);
  display:flex;
  align-items:center;
  gap:4px;
}
.achievement-icon{
  width:24px;
  height:24px;
  border-radius:50%;
  background:linear-gradient(135deg,#ffd166,#ffb84d);
  display:flex;
  align-items:center;
  justify-content:center;
  font-size:12px;
}
.achievement-info{
  flex:1;
  font-size:10px;
}
.achievement-info .name{
  font-weight:700;
  color:#ffd166;
}
.achievement-info .desc{
  color:var(--muted);
}
.achievement-reward{
  background:rgba(255,213,102,0.1);
  padding:2px 4px;
  border-radius:4px;
  font-size:10px;
  color:#ffd166;
  font-weight:700;
}
.achievement-completed{
  opacity:0.6;
}
.achievement-completed .achievement-icon{
  background:linear-gradient(135deg,#7fd3ff,#5ea6ff);
}
.achievement-notification{
  position:fixed;
  top:60px;
  left:50%;
  transform:translateX(-50%);
  background:rgba(255, 213, 102, 0.2);
  padding:8px 12px;
  border-radius:99px;
  border:1px solid rgba(255,213,102,0.3);
  z-index:9999;
  max-width:80%;
  text-align:center;
  transition:opacity 1s;
}

/* –ù–û–í–û–ï: —Å—Ç–∏–ª–∏ –¥–ª—è —è–∏—Ü —Å —à–∞–Ω—Å–∞–º–∏ */
.egg-chances {
  background: rgba(255,213,102,0.1);
  border-radius: 4px;
  padding: 4px;
  font-size: 9px;
  color: #ffd166;
  margin-top: 2px;
}
.egg-chance {
  display: flex;
  justify-content: space-between;
}
.common-chance { color: #7fd3ff; }
.rare-chance { color: #ffd166; }
.epic-chance { color: #ff7ec7; }
.legendary-chance { color: #ff5a7a; }

/* MOBILE ADAPTATION */
@media (max-width:500px){
  .container{padding:6px}
  .header{gap:4px}
  .title{font-size:16px}
  .top-stats{gap:4px}
  .stat{padding:4px 6px;min-width:60px}
  .stat .v{font-size:12px}
  .play-area{min-height:300px}
  .controls{gap:4px}
  .btn-primary{padding:6px 8px;font-size:12px}
  .btn-ghost{padding:4px 6px}
  .feed{min-height:150px;max-height:200px}
  .upgrades-grid{gap:4px}
  .upgrade-card{padding:4px}
  .upgrade-name{font-size:12px}
  .upgrade-meta{font-size:9px}
  .progress{height:4px}
  .inv-list{max-height:100px}
  .small{font-size:9px}
  .footer{font-size:9px}
  .quest-row{padding:3px 4px}
  .event-btn{padding:6px}
  .event-shop-item, .pet-shop-item{padding:6px}
  .event-shop-item .name{font-size:12px}
  .event-shop-item .cost{gap:2px}
  .pet-shop-item .pet-icon{width:28px;height:28px}
  .pet-modal-content{max-width:280px}
  .pet-slot{width:40px;height:40px}
}

/* Small visual polish */
body.mobile-open{ overflow:hidden; } 
</style>
</head>
<body>
<div class="container">
  <div class="header">
    <div class="logo">
      <svg viewBox="0 0 64 64" xmlns="http://www.w3.org/2000/svg"><rect x="4" y="4" width="56" height="56" rx="12" fill="#062432"/><circle cx="32" cy="24" r="8" fill="#ffd166"/><path d="M22 36c6 6 14 6 20 0" stroke="#9fd3ff" stroke-width="2" fill="none" stroke-linecap="round"/></svg>
    </div>
    <div>
      <div class="title">–°–∏–º—É–ª—è—Ç–æ—Ä –£–¥–∞—á–∏ ‚Äî –†–µ–ª–∏–∑–Ω—ã–π —Ñ–µ—Å—Ç–∏–≤–∞–ª—å</div>
      <div class="small">–ê–≤—Ç–æ-–∏–≤–µ–Ω—Ç—ã, –∫–≤–µ—Å—Ç—ã, 100 –∞–ø–≥—Ä–µ–π–¥–æ–≤ –∏ –ª–æ–∫–∞–ª—å–Ω–æ–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ</div>
    </div>
    <div class="top-stats">
      <div class="stat"><div class="small">–ú–æ–Ω–µ—Ç—ã</div><div class="v" id="coins">0</div></div>
      <div class="stat"><div class="small">–£—Ä–æ–≤–µ–Ω—å</div><div class="v" id="lvl">1</div></div>
      <div class="stat"><div class="small">–ü–∞—Å—Å–∏–≤</div><div class="v" id="pps">0/s</div></div>
    </div>
  </div>

  <div class="play-area">
    <div class="controls">
      <button id="tryBtn" class="btn-primary">–ò—Å–ø—ã—Ç–∞—Ç—å —É–¥–∞—á—É</button>
      <button id="spinWheel" class="btn-ghost">–ö–æ–ª–µ—Å–æ —Ñ–æ—Ä—Ç—É–Ω—ã</button>
      <button id="toggleAuto" class="btn-ghost">–ê–≤—Ç–æ: –≤—ã–∫–ª</button>
      <button id="mobileMenuBtn" class="btn-ghost" aria-label="–ú–µ–Ω—é">–ú–µ–Ω—é</button>

      <div style="min-width:120px;text-align:right">
        <div class="small">–û–ø—ã—Ç –¥–æ —É—Ä–æ–≤–Ω—è</div>
        <div class="progress" style="margin-top:4px"><i id="xpbar" style="width:0%"></i></div>
      </div>
    </div>

    <div class="feed" id="feed"></div>

    <div style="display:flex;gap:8px;align-items:center;">
      <div style="flex:1">
        <div class="section">
          <strong>–ö–≤–µ—Å—Ç</strong>
          <div id="questArea" class="small" style="margin-top:6px"></div>
        </div>
      </div>
      <div style="width:220px">
        <div class="section" style="display:flex;flex-direction:column;gap:4px">
          <div style="display:flex;justify-content:space-between;align-items:center">
            <div><strong>–°–æ–±—ã—Ç–∏—è</strong><div class="small">–†–µ–ª–∏–∑–Ω—ã–π —Ñ–µ—Å—Ç–∏–≤–∞–ª—å –∏ –ù–æ–≤–∞—è –∏–≥—Ä–∞!</div></div>
            <div>
              <div style="display:flex;gap:4px;flex-direction:column">
                <div style="display:flex;gap:4px">
                  <button id="eventBtn" class="event-btn">–†–µ–ª–∏–∑–Ω—ã–π —Ñ–µ—Å—Ç–∏–≤–∞–ª—å</button>
                  <button id="newEventBtn" class="event-btn" style="background:linear-gradient(180deg,#ff5a7a,#ff7ec7)">–ù–æ–≤–∞—è –∏–≥—Ä–∞!</button>
                </div>
                <button id="petsBtn" class="event-btn" style="background:linear-gradient(180deg,#7fd3ff,#5ea6ff)">–ü–∏—Ç–æ–º—Ü—ã</button>
              </div>
            </div>
          </div>
          <div id="eventStatus" class="small" style="margin-top:4px">C–æ–±—ã—Ç–∏–µ –Ω–µ –∞–∫—Ç–∏–≤–Ω–æ</div>
        </div>
      </div>
    </div>

    <div class="section" style="margin-top:6px">
      <div style="display:flex;align-items:center;gap:6px">
        <div>–ü–∏—Ç–æ–º—Ü—ã:</div>
        <div class="pet-slot" id="petSlot1"></div>
        <div class="pet-slot" id="petSlot2"></div>
        <div style="margin-left:auto">
          <div class="small">–ú–Ω–æ–∂–∏—Ç–µ–ª—å: <span id="petMult">x1</span></div>
        </div>
      </div>
    </div>

    <div style="display:flex;gap:4px;align-items:center;justify-content:space-between">
      <div class="small">–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ: Space ‚Äî –∏—Å–ø—ã—Ç–∞—Ç—å —É–¥–∞—á—É ¬∑ S ‚Äî –æ—Ç–∫—Ä—ã—Ç—å –ø–µ—Ä–≤—ã–π –¥–æ—Å—Ç—É–ø–Ω—ã–π –∞–ø–≥—Ä–µ–π–¥</div>
      <div style="display:flex;gap:4px">
        <button id="exportState" class="btn-ghost">–≠–∫—Å–ø–æ—Ä—Ç</button>
        <button id="importState" class="btn-ghost">–ò–º–ø–æ—Ä—Ç</button>
        <button id="resetAll" class="btn-ghost">–°–±—Ä–æ—Å</button>
      </div>
    </div>
  </div>

  <div class="side-panel" id="sidePanel">
    <div class="section">
      <strong>–£–ª—É—á—à–µ–Ω–∏—è (100)</strong>
      <div class="upgrades-grid" id="upgradesGrid"></div>
    </div>

    <div class="section" id="eventShopSection" style="display:none">
      <strong>–≠–ø–∏—á–µ—Å–∫–∏–π –º–∞–≥–∞–∑–∏–Ω –∏–≤–µ–Ω—Ç–∞</strong>
      <div class="small" style="margin-top:2px;color:#ff7ec7">–¢–æ–ª—å–∫–æ –≤–æ –≤—Ä–µ–º—è —Å–æ–±—ã—Ç–∏—è! 1 –ø–æ–∫—É–ø–∫–∞ –Ω–∞ –ø—Ä–µ–¥–º–µ—Ç</div>
      <div class="event-shop-grid" id="eventShopGrid"></div>
    </div>
    
    <div class="section" id="petsShopSection">
      <strong>–ú–∞–≥–∞–∑–∏–Ω –ø–∏—Ç–æ–º—Ü–µ–≤</strong>
      <div class="small" style="margin-top:2px">–ö—É–ø–∏ —è–π—Ü–æ –∏–ª–∏ –ø–∏—Ç–æ–º—Ü–∞</div>
      <div class="pets-shop-grid" id="petsShopGrid"></div>
    </div>
    
    <!-- –ù–û–í–û–ï: —Å–µ–∫—Ü–∏—è –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–π -->
    <div class="section" id="achievementsSection">
      <strong>–î–æ—Å—Ç–∏–∂–µ–Ω–∏—è <span id="achievementsCounter">(0/0)</span></strong>
      <div class="small" style="margin-top:2px;color:#ffd166">–ü–æ–ª—É—á–∞–π –Ω–∞–≥—Ä–∞–¥—ã –∑–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –∑–∞–¥–∞–Ω–∏–π</div>
      <div class="achievements-section" id="achievementsList"></div>
    </div>

    <div class="section">
      <strong>–ò–Ω–≤–µ–Ω—Ç–∞—Ä—å</strong>
      <div class="inv-list" id="inventory"></div>
    </div>

    <div class="section">
      <strong>–°—Ç–∞—Ç—É—Å—ã</strong>
      <div class="small">–†–µ–¥–∫–∏–π —à–∞–Ω—Å: <span id="rarePct">2%</span></div>
      <div class="small">–ú–Ω–æ–∂–∏—Ç–µ–ª—å: <span id="mult">x1</span></div>
      <div class="small">–ü–∞—Å—Å–∏–≤: <span id="ppsSide">0/s</span></div>
    </div>
    
    <div class="section">
      <strong>–ù–∞—Å—Ç—Ä–æ–π–∫–∏</strong>
      <div class="settings-panel">
        <div>–Ø–∑—ã–∫ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞</div>
        <div class="lang-selector">
          <button class="lang-btn active" data-lang="ru">–†—É—Å—Å–∫–∏–π</button>
          <button class="lang-btn" data-lang="en">English</button>
          <button class="lang-btn" data-lang="cs">ƒåe≈°tina</button>
        </div>
      </div>
    </div>
  </div>

  <div class="footer">–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ: localStorage. –û—Ç–∫—Ä—ã–≤–∞–π –≤ Acode/–±—Ä–∞—É–∑–µ—Ä–µ.</div>
</div>

<!-- –ú–æ–¥–∞–ª—å–Ω—ã–µ –æ–∫–Ω–∞ -->
<div class="pet-modal" id="petModal">
  <div class="pet-modal-content">
    <div class="pet-modal-header">
      <div><strong>–í—ã–±–æ—Ä –ø–∏—Ç–æ–º—Ü–µ–≤</strong> <span class="small">(–≤—ã–±–µ—Ä–∏—Ç–µ –¥–æ 2)</span></div>
      <div id="closePetModal" style="cursor:pointer">&times;</div>
    </div>
    <div class="pet-modal-body">
      <div id="petInventoryGrid" style="display:grid;grid-template-columns:repeat(2,1fr);gap:6px"></div>
    </div>
    <div class="pet-modal-footer">
      <button id="savePetsBtn" class="btn-primary">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –≤—ã–±–æ—Ä</button>
    </div>
  </div>
</div>

<div id="toast" class="toast"></div>

<script>
/* –ü–æ–ª–Ω—ã–π —Å–∫—Ä–∏–ø—Ç ‚Äî –≤–∫–ª—é—á–∞–µ—Ç:
   1. –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ç–µ–∫—Å—Ç–∞ –Ω–∞ –∫–Ω–æ–ø–∫–µ —è–π—Ü–∞ (—Ç–µ–ø–µ—Ä—å "–ö—É–ø–∏—Ç—å —è–π—Ü–æ")
   2. –ü—Ä–æ–≤–µ—Ä–∫—É –º–æ–Ω–µ—Ç –ø—Ä–∏ –ø–æ–∫—É–ø–∫–µ —è–π—Ü–∞
   3. –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–Ω–æ–ø–∫–∏ "–ù–æ–≤–∞—è –∏–≥—Ä–∞" 
   4. –ú–∞–≥–∞–∑–∏–Ω –ø–∏—Ç–æ–º—Ü–µ–≤ –∏ —è–∏—Ü —Å –ù–û–í–´–ú–ò –®–ê–ù–°–ê–ú–ò –í–´–õ–£–ü–õ–ï–ù–ò–Ø
   5. –°–∏—Å—Ç–µ–º—É –≤—ã–±–æ—Ä–∞ –¥–≤—É—Ö –∞–∫—Ç–∏–≤–Ω—ã—Ö –ø–∏—Ç–æ–º—Ü–µ–≤ —á–µ—Ä–µ–∑ –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ
   6. –ó–∞–¥–µ—Ä–∂–∫—É 350 —Å–µ–∫—É–Ω–¥ –º–µ–∂–¥—É –∞–∫—Ç–∏–≤–∞—Ü–∏—è–º–∏ —Å–æ–±—ã—Ç–∏–π
   7. –£—Å–∏–ª–µ–Ω–Ω—ã–µ –∞–ø–≥—Ä–µ–π–¥—ã (+50% –∫ —ç—Ñ—Ñ–µ–∫—Ç–∞–º)
   8. –ù–∞—Å—Ç—Ä–æ–π–∫–∏ —è–∑—ã–∫–∞ (—Ä—É—Å—Å–∫–∏–π, –∞–Ω–≥–ª–∏–π—Å–∫–∏–π, —á–µ—à—Å–∫–∏–π)
   9. –ú–æ–±–∏–ª—å–Ω–æ–µ –º–µ–Ω—é (–≤—ã–¥–≤–∏–∂–Ω–∞—è –ø–∞–Ω–µ–ª—å)
   10. –ù–ï–ü–†–û–ó–†–ê–ß–ù–û–ï –º–µ–Ω—é –∞–ø–≥—Ä–µ–π–¥–æ–≤
   11. –°–ò–°–¢–ï–ú–ê –î–û–°–¢–ò–ñ–ï–ù–ò–ô */ 

// ---------- –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –∏ –∫–æ–Ω—Å—Ç–∞–Ω—Ç—ã ----------
const STORAGE_KEY = 'luck_sim_release_v1';
const BASE_COOLDOWN_MS = 5000;
const MIN_COOLDOWN_MS = 800;

// RANDOM event chance bounds (0.6% - 0.9% -> 0.006 - 0.009)
const RANDOM_EVENT_MIN = 0.006;
const RANDOM_EVENT_MAX = 0.009;
const EVENT_NAME = "–†–µ–ª–∏–∑–Ω—ã–π —Ñ–µ—Å—Ç–∏–≤–∞–ª—å —É–¥–∞—á–∏";
// –ù–û–í–û–ï: —É–≤–µ–ª–∏—á–µ–Ω–∞ –∑–∞–¥–µ—Ä–∂–∫–∞ –¥–æ 350 —Å–µ–∫—É–Ω–¥ (350_000 –º—Å)
const EVENT_DURATION_MS = 20_000; // 20s
const EVENT_COOLDOWN_MS = 350_000; // 350s (–±—ã–ª–æ 60_000)

// –ù–û–í–û–ï –°–û–ë–´–¢–ò–ï: –∫–æ–Ω—Å—Ç–∞–Ω—Ç—ã –¥–ª—è –∏–≤–µ–Ω—Ç–∞ "–í —á–µ—Å—Ç—å –Ω–æ–≤–æ–π –∏–≥—Ä—ã"
const NEW_EVENT_NAME = "‚ú® –í —á–µ—Å—Ç—å –Ω–æ–≤–æ–π –∏–≥—Ä—ã!";
const NEW_EVENT_DURATION_MS = 15_000; // 15s
// –ù–û–í–û–ï: —É–≤–µ–ª–∏—á–µ–Ω–∞ –∑–∞–¥–µ—Ä–∂–∫–∞ –¥–æ 350 —Å–µ–∫—É–Ω–¥
const NEW_EVENT_COOLDOWN_MS = 350_000; // 350s (–±—ã–ª–æ 45_000)

// –ù–û–í–û–ï: —ç–ø–∏—á–Ω—ã–µ –ø—Ä–µ–¥–º–µ—Ç—ã –¥–ª—è –∏–≤–µ–Ω—Ç-–º–∞–≥–∞–∑–∏–Ω–∞
const EVENT_SHOP_ITEMS = [
  {
    id: 'mythical_amulet',
    name: '–ú–∏—Ñ–∏—á–µ—Å–∫–∏–π –∞–º—É–ª–µ—Ç —É–¥–∞—á–∏',
    desc: '+10% –∫ —à–∞–Ω—Å—É —Ä–µ–¥–∫–∏—Ö –≤—ã–ø–∞–¥–µ–Ω–∏–π (–ø–æ—Å—Ç–æ—è–Ω–Ω–æ)',
    cost: 6500,
    effect: { type: 'rare', val: 10 },
    available: true
  },
  {
    id: 'eternal_engine',
    name: '–í–µ—á–Ω—ã–π –¥–≤–∏–≥–∞—Ç–µ–ª—å –∫–ª–∏–∫–æ–≤',
    desc: 'x2 –∫ –ø–∞—Å—Å–∏–≤–Ω–æ–º—É –¥–æ—Ö–æ–¥—É (–ø–æ—Å—Ç–æ—è–Ω–Ω–æ)',
    cost: 5000,
    effect: { type: 'pps', val: 100 },
    available: true
  },
  {
    id: 'god_hand',
    name: '–ë–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω–∞—è —Ä—É–∫–∞',
    desc: '–ú–Ω–æ–∂–∏—Ç–µ–ª—å x2 –∫–æ –≤—Å–µ–º –≤—ã–ø–∞–¥–µ–Ω–∏—è–º (–ø–æ—Å—Ç–æ—è–Ω–Ω–æ)',
    cost: 7500,
    effect: { type: 'mult', val: 1 },
    available: true
  }
];

// –ù–û–í–û–ï: –ø–∏—Ç–æ–º—Ü—ã —Å —Ä–µ–¥–∫–æ—Å—Ç—å—é –∏ –º–Ω–æ–∂–∏—Ç–µ–ª–µ–º
const PETS = [
  {
    id: 'pet1',
    name: '–î—Ä—É–∂–µ–ª—é–±–Ω—ã–π –∫—Ä–æ–ª–∏–∫',
    rarity: 'common',
    multiplier: 1.05,
    cost: 1500,
    icon: 'üêá',
    desc: '–û–±—ã—á–Ω—ã–π –ø–∏—Ç–æ–º–µ—Ü'
  },
  {
    id: 'pet2',
    name: '–•–∏—Ç—Ä—ã–π –ª–∏—Å',
    rarity: 'rare',
    multiplier: 1.15,
    cost: 4000,
    icon: 'ü¶ä',
    desc: '–†–µ–¥–∫–∏–π –ø–∏—Ç–æ–º–µ—Ü'
  },
  {
    id: 'pet3',
    name: '–ì—Ä–æ–∑–Ω—ã–π –¥—Ä–∞–∫–æ–Ω',
    rarity: 'epic',
    multiplier: 1.3,
    cost: 8500,
    icon: 'üêâ',
    desc: '–≠–ø–∏—á–µ—Å–∫–∏–π –ø–∏—Ç–æ–º–µ—Ü'
  },
  {
    id: 'pet4',
    name: '–í–µ–ª–∏—á–µ—Å—Ç–≤–µ–Ω–Ω—ã–π —Ñ–µ–Ω–∏–∫—Å',
    rarity: 'legendary',
    multiplier: 1.5,
    cost: 15000,
    icon: 'ü¶Ö',
    desc: '–õ–µ–≥–µ–Ω–¥–∞—Ä–Ω—ã–π –ø–∏—Ç–æ–º–µ—Ü'
  }
];

// –ù–û–í–û–ï: —à–∞–Ω—Å—ã –≤—ã–ª—É–ø–ª–µ–Ω–∏—è –∏–∑ —è–π—Ü–∞
const EGG_HATCH_CHANCES = {
  common: 40,   // 40% —à–∞–Ω—Å –Ω–∞ –æ–±—ã—á–Ω–æ–≥–æ –ø–∏—Ç–æ–º—Ü–∞
  rare: 30,     // 30% —à–∞–Ω—Å –Ω–∞ —Ä–µ–¥–∫–æ–≥–æ –ø–∏—Ç–æ–º—Ü–∞
  epic: 15,     // 15% —à–∞–Ω—Å –Ω–∞ —ç–ø–∏—á–µ—Å–∫–æ–≥–æ –ø–∏—Ç–æ–º—Ü–∞
  legendary: 5  // 5% —à–∞–Ω—Å –Ω–∞ –ª–µ–≥–µ–Ω–¥–∞—Ä–Ω–æ–≥–æ –ø–∏—Ç–æ–º—Ü–∞
  // –û—Å—Ç–∞–≤—à–∏–µ—Å—è 10% - —è–π—Ü–æ –Ω–µ –≤—ã–ª—É–ø–∏—Ç—Å—è
};

// –ù–û–í–û–ï: –ø–µ—Ä–µ–≤–æ–¥—ã –¥–ª—è —Ä–∞–∑–Ω—ã—Ö —è–∑—ã–∫–æ–≤
const translations = {
  ru: {
    title: "–°–∏–º—É–ª—è—Ç–æ—Ä –£–¥–∞—á–∏ ‚Äî –†–µ–ª–∏–∑–Ω—ã–π —Ñ–µ—Å—Ç–∏–≤–∞–ª—å",
    subtitle: "–ê–≤—Ç–æ-–∏–≤–µ–Ω—Ç—ã, –∫–≤–µ—Å—Ç—ã, 100 –∞–ø–≥—Ä–µ–π–¥–æ–≤ –∏ –ª–æ–∫–∞–ª—å–Ω–æ–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ",
    coins: "–ú–æ–Ω–µ—Ç—ã",
    level: "–£—Ä–æ–≤–µ–Ω—å",
    passive: "–ü–∞—Å—Å–∏–≤",
    tryBtn: "–ò—Å–ø—ã—Ç–∞—Ç—å —É–¥–∞—á—É",
    spinWheel: "–ö–æ–ª–µ—Å–æ —Ñ–æ—Ä—Ç—É–Ω—ã",
    auto: "–ê–≤—Ç–æ",
    xpToLevel: "–û–ø—ã—Ç –¥–æ —É—Ä–æ–≤–Ω—è",
    quest: "–ö–≤–µ—Å—Ç",
    events: "–°–æ–±—ã—Ç–∏—è",
    eventDesc: "–†–µ–ª–∏–∑–Ω—ã–π —Ñ–µ—Å—Ç–∏–≤–∞–ª—å –∏ –ù–æ–≤–∞—è –∏–≥—Ä–∞!",
    eventBtn1: "–†–µ–ª–∏–∑–Ω—ã–π —Ñ–µ—Å—Ç–∏–≤–∞–ª—å",
    eventBtn2: "–ù–æ–≤–∞—è –∏–≥—Ä–∞!",
    petsBtn: "–ü–∏—Ç–æ–º—Ü—ã",
    noEventActive: "C–æ–±—ã—Ç–∏–µ –Ω–µ –∞–∫—Ç–∏–≤–Ω–æ",
    eventShopTitle: "–≠–ø–∏—á–µ—Å–∫–∏–π –º–∞–≥–∞–∑–∏–Ω –∏–≤–µ–Ω—Ç–∞",
    eventShopDesc: "–¢–æ–ª—å–∫–æ –≤–æ –≤—Ä–µ–º—è —Å–æ–±—ã—Ç–∏—è! 1 –ø–æ–∫—É–ø–∫–∞ –Ω–∞ –ø—Ä–µ–¥–º–µ—Ç",
    petsShopTitle: "–ú–∞–≥–∞–∑–∏–Ω –ø–∏—Ç–æ–º—Ü–µ–≤",
    petsShopDesc: "–ö—É–ø–∏ –ø–∏—Ç–æ–º—Ü–∞ –∏–ª–∏ —è–π—Ü–æ",
    noPet: "–ù–µ—Ç –ø–∏—Ç–æ–º—Ü–∞",
    petMult: "–ü–∏—Ç–æ–º—Ü—ã",
    controls: "–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ: Space ‚Äî –∏—Å–ø—ã—Ç–∞—Ç—å —É–¥–∞—á—É ¬∑ S ‚Äî –æ—Ç–∫—Ä—ã—Ç—å –ø–µ—Ä–≤—ã–π –¥–æ—Å—Ç—É–ø–Ω—ã–π –∞–ø–≥—Ä–µ–π–¥",
    settings: "–ù–∞—Å—Ç—Ä–æ–π–∫–∏",
    langLabel: "–Ø–∑—ã–∫ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞",
    exportBtn: "–≠–∫—Å–ø–æ—Ä—Ç",
    importBtn: "–ò–º–ø–æ—Ä—Ç",
    resetBtn: "–°–±—Ä–æ—Å",
    footer: "–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ: localStorage. –û—Ç–∫—Ä—ã–≤–∞–π –≤ Acode/–±—Ä–∞—É–∑–µ—Ä–µ.",
    rareChance: "–†–µ–¥–∫–∏–π —à–∞–Ω—Å",
    multiplier: "–ú–Ω–æ–∂–∏—Ç–µ–ª—å",
    inventory: "–ò–Ω–≤–µ–Ω—Ç–∞—Ä—å",
    upgrades: "–£–ª—É—á—à–µ–Ω–∏—è (100)",
    stats: "–°—Ç–∞—Ç—É—Å—ã",
    petBought: "–ü–∏—Ç–æ–º–µ—Ü –∫—É–ø–ª–µ–Ω!",
    petActivated: "–ü–∏—Ç–æ–º—Ü—ã –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω—ã!",
    petHatched: "–ò–∑ —è–π—Ü–∞ –≤—ã–ª—É–ø–∏–ª—Å—è",
    petEgg: "–Ø–π—Ü–æ –ø–∏—Ç–æ–º—Ü–∞",
    petSelect: "–í—ã–±–æ—Ä –ø–∏—Ç–æ–º—Ü–µ–≤",
    petSelectDesc: "(–≤—ã–±–µ—Ä–∏—Ç–µ –¥–æ 2)",
    petSave: "–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –≤—ã–±–æ—Ä",
    petMax: "–ú–æ–∂–Ω–æ –≤—ã–±—Ä–∞—Ç—å —Ç–æ–ª—å–∫–æ –¥–≤—É—Ö –ø–∏—Ç–æ–º—Ü–µ–≤!",
    petSlot: "–°–ª–æ—Ç –¥–ª—è –ø–∏—Ç–æ–º—Ü–∞",
    eggChancesTitle: "–®–∞–Ω—Å—ã –≤—ã–ª—É–ø–ª–µ–Ω–∏—è:",
    eggCommon: "–û–±—ã—á–Ω—ã–π: 40%",
    eggRare: "–†–µ–¥–∫–∏–π: 30%",
    eggEpic: "–≠–ø–∏—á–µ—Å–∫–∏–π: 15%",
    eggLegendary: "–õ–µ–≥–µ–Ω–¥–∞—Ä–Ω—ã–π: 5%",
    eggNoHatch: "–ù–µ –≤—ã–ª—É–ø–∏—Ç—Å—è: 10%",
    eggBought: "–ö—É–ø–ª–µ–Ω–æ —è–π—Ü–æ!",
    eggHatched: "–ò–∑ —è–π—Ü–∞ –≤—ã–ª—É–ø–∏–ª—Å—è",
    eggNoHatchMsg: "–Ø–π—Ü–æ –Ω–µ –≤—ã–ª—É–ø–∏–ª–æ—Å—å... –ü–æ–ø—Ä–æ–±—É–π –µ—â—ë —Ä–∞–∑!",
    eggDuplicate: "–£ –≤–∞—Å —É–∂–µ –µ—Å—Ç—å —ç—Ç–æ—Ç –ø–∏—Ç–æ–º–µ—Ü!",
    eggRefund: "–í–∞–º –≤–æ–∑–≤—Ä–∞—â–µ–Ω–æ {coins} –º–æ–Ω–µ—Ç",
    // –ù–û–í–û–ï: –ø–µ—Ä–µ–≤–æ–¥—ã –¥–ª—è –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–π
    achievements: "–î–æ—Å—Ç–∏–∂–µ–Ω–∏—è",
    achievementCompleted: "–í—ã–ø–æ–ª–Ω–µ–Ω–æ!",
    achievementReward: "–ù–∞–≥—Ä–∞–¥–∞: {reward} –º–æ–Ω.",
    achievementFirstClick: "–ü–µ—Ä–≤—ã–π –∫–ª–∏–∫",
    achievementFirstClickDesc: "–°–¥–µ–ª–∞–π –ø–µ—Ä–≤—ã–π –∫–ª–∏–∫",
    achievementLvl5: "–ü—è—Ç—ã–π —É—Ä–æ–≤–µ–Ω—å",
    achievementLvl5Desc: "–î–æ—Å—Ç–∏–≥–Ω–∏ 5 —É—Ä–æ–≤–Ω—è",
    achievement1000Coins: "–¢—ã—Å—è—á–Ω–∏–∫",
    achievement1000CoinsDesc: "–ù–∞–±–µ—Ä–∏ 1000 –º–æ–Ω–µ—Ç",
    achievement50Upgrades: "–£–ª—É—á—à–∞—Ç–µ–ª—å",
    achievement50UpgradesDesc: "–ö—É–ø–∏ 50 —É–ª—É—á—à–µ–Ω–∏–π",
    achievementPetCollector: "–ö–æ–ª–ª–µ–∫—Ü–∏–æ–Ω–µ—Ä",
    achievementPetCollectorDesc: "–°–æ–±–µ—Ä–∏ –≤—Å–µ—Ö –ø–∏—Ç–æ–º—Ü–µ–≤",
    // –ù–û–í–û–ï: –ø–µ—Ä–µ–≤–æ–¥—ã –¥–ª—è —É–ª—É—á—à–µ–Ω–∏–π
    upgradeBuy: "–ö—É–ø–∏—Ç—å",
    upgradeInProgress: "–ü–æ–∫—É–ø–∞–µ—Ç—Å—è...",
    upgradePurchased: "–ö—É–ø–ª–µ–Ω–æ",
    // –ù–û–í–û–ï: –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–µ —Ç–µ–∫—Å—Ç—ã –¥–ª—è —è–π—Ü–∞
    petEgg: "–ö—É–ø–∏—Ç—å —è–π—Ü–æ",  // –¢–µ–ø–µ—Ä—å –ø—Ä–∞–≤–∏–ª—å–Ω–æ
    eggPurchaseFailed: "–ù—É–∂–Ω–æ {coins} –º–æ–Ω–µ—Ç", // –ù–æ–≤—ã–π —Ç–µ–∫—Å—Ç –¥–ª—è –æ—à–∏–±–∫–∏
  },
  en: {
    title: "Luck Simulator ‚Äî Release Festival",
    subtitle: "Auto-events, quests, 100 upgrades and local save",
    coins: "Coins",
    level: "Level",
    passive: "Passive",
    tryBtn: "Try your luck",
    spinWheel: "Spin wheel",
    auto: "Auto",
    xpToLevel: "XP to level",
    quest: "Quest",
    events: "Events",
    eventDesc: "Release Festival and New Game!",
    eventBtn1: "Release Festival",
    eventBtn2: "New Game!",
    petsBtn: "Pets",
    noEventActive: "No event active",
    eventShopTitle: "Epic Event Shop",
    eventShopDesc: "Only during event! 1 purchase per item",
    petsShopTitle: "Pet Shop",
    petsShopDesc: "Buy a pet or an egg",
    noPet: "No pet",
    petMult: "Pets",
    controls: "Controls: Space ‚Äî try luck ¬∑ S ‚Äî open first available upgrade",
    settings: "Settings",
    langLabel: "Interface language",
    exportBtn: "Export",
    importBtn: "Import",
    resetBtn: "Reset",
    footer: "Save: localStorage. Open in Acode/browser.",
    rareChance: "Rare chance",
    multiplier: "Multiplier",
    inventory: "Inventory",
    upgrades: "Upgrades (100)",
    stats: "Status",
    petBought: "Pet bought!",
    petActivated: "Pets activated!",
    petHatched: "Hatched from egg",
    petEgg: "Pet egg",
    petSelect: "Pet Selection",
    petSelectDesc: "(select up to 2)",
    petSave: "Save selection",
    petMax: "You can select only two pets!",
    petSlot: "Pet slot",
    eggChancesTitle: "Hatching chances:",
    eggCommon: "Common: 40%",
    eggRare: "Rare: 30%",
    eggEpic: "Epic: 15%",
    eggLegendary: "Legendary: 5%",
    eggNoHatch: "No hatch: 10%",
    eggBought: "Egg bought!",
    eggHatched: "Hatched from egg",
    eggNoHatchMsg: "Egg didn't hatch... Try again!",
    eggDuplicate: "You already have this pet!",
    eggRefund: "Refunded {coins} coins",
    // –ù–û–í–û–ï: –ø–µ—Ä–µ–≤–æ–¥—ã –¥–ª—è –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–π
    achievements: "Achievements",
    achievementCompleted: "Completed!",
    achievementReward: "Reward: {reward} coins",
    achievementFirstClick: "First click",
    achievementFirstClickDesc: "Make your first click",
    achievementLvl5: "Level 5",
    achievementLvl5Desc: "Reach level 5",
    achievement1000Coins: "Thousand",
    achievement1000CoinsDesc: "Collect 1000 coins",
    achievement50Upgrades: "Upgrader",
    achievement50UpgradesDesc: "Buy 50 upgrades",
    achievementPetCollector: "Pet Collector",
    achievementPetCollectorDesc: "Collect all pets",
    // –ù–û–í–û–ï: –ø–µ—Ä–µ–≤–æ–¥—ã –¥–ª—è —É–ª—É—á—à–µ–Ω–∏–π
    upgradeBuy: "Buy",
    upgradeInProgress: "Buying...",
    upgradePurchased: "Purchased",
    // –ù–û–í–û–ï: –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–µ —Ç–µ–∫—Å—Ç—ã –¥–ª—è —è–π—Ü–∞
    petEgg: "Buy egg",
    eggPurchaseFailed: "Need {coins} coins",
  },
  cs: {
    title: "Simul√°tor ≈°tƒõst√≠ ‚Äî Vyd√°n√≠ festivalu",
    subtitle: "Auto-ud√°losti, √∫koly, 100 vylep≈°en√≠ a lok√°ln√≠ ulo≈æen√≠",
    coins: "Mince",
    level: "√örove≈à",
    passive: "Pasivn√≠",
    tryBtn: "Vyzkou≈°et ≈°tƒõst√≠",
    spinWheel: "Kolo ≈°tƒõst√≠",
    auto: "Auto",
    xpToLevel: "Zku≈°enosti do √∫rovnƒõ",
    quest: "√ökol",
    events: "Ud√°losti",
    eventDesc: "Vyd√°n√≠ festivalu a Nov√° hra!",
    eventBtn1: "Vyd√°n√≠ festivalu",
    eventBtn2: "Nov√° hra!",
    petsBtn: "Mazl√≠ƒçci",
    noEventActive: "≈Ω√°dn√° ud√°lost aktivn√≠",
    eventShopTitle: "Epick√Ω eventov√Ω obchod",
    eventShopDesc: "Pouze bƒõhem ud√°losti! 1 n√°kup na p≈ôedmƒõt",
    petsShopTitle: "Obchod s mazl√≠ƒçky",
    petsShopDesc: "Kupte si mazl√≠ƒçka nebo vejce",
    noPet: "≈Ω√°dn√Ω mazl√≠ƒçek",
    petMult: "Mazl√≠ƒçci",
    controls: "Ovl√°d√°n√≠: Space ‚Äî vyzkou≈°et ≈°tƒõst√≠ ¬∑ S ‚Äî otev≈ô√≠t prvn√≠ dostupn√© vylep≈°en√≠",
    settings: "Nastaven√≠",
    langLabel: "Jazyk rozhran√≠",
    exportBtn: "Export",
    importBtn: "Import",
    resetBtn: "Reset",
    footer: "Ulo≈æen√≠: localStorage. Otev≈ôi v Acode/prohl√≠≈æeƒçi.",
    rareChance: "≈†ance na raritu",
    multiplier: "N√°sobiƒç",
    inventory: "Invent√°≈ô",
    upgrades: "Vylep≈°en√≠ (100)",
    stats: "Stav",
    petBought: "Mazl√≠ƒçek koupen!",
    petActivated: "Mazl√≠ƒçci aktivov√°ni!",
    petHatched: "Z vejce se vyl√≠hl",
    petEgg: "Vejce mazl√≠ƒçka",
    petSelect: "V√Ωbƒõr mazl√≠ƒçk≈Ø",
    petSelectDesc: "(vyberte a≈æ 2)",
    petSave: "Ulo≈æit v√Ωbƒõr",
    petMax: "M≈Ø≈æete vybrat pouze dva mazl√≠ƒçky!",
    petSlot: "Slot pro mazl√≠ƒçka",
    eggChancesTitle: "≈†ance na vyl√≠hnut√≠:",
    eggCommon: "Bƒõ≈æn√©: 40%",
    eggRare: "Vz√°cn√©: 30%",
    eggEpic: "Epick√©: 15%",
    eggLegendary: "Legend√°rn√≠: 5%",
    eggNoHatch: "Nevyl√≠hne se: 10%",
    eggBought: "Koupeno vejce!",
    eggHatched: "Z vejce se vyl√≠hl",
    eggNoHatchMsg: "Vejce se nevyl√≠hlo... Zkuste znovu!",
    eggDuplicate: "Tento mazl√≠ƒçek ji≈æ m√°te!",
    eggRefund: "Vr√°ceno {coins} minc√≠",
    // –ù–û–í–û–ï: –ø–µ—Ä–µ–≤–æ–¥—ã –¥–ª—è –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–π
    achievements: "√öspƒõchy",
    achievementCompleted: "Dokonƒçeno!",
    achievementReward: "Odmena: {reward} minc√≠",
    achievementFirstClick: "Prvn√≠ klik",
    achievementFirstClickDesc: "Udƒõlejte sv≈Øj prvn√≠ klik",
    achievementLvl5: "√örove≈à 5",
    achievementLvl5Desc: "Dos√°hnƒõte 5. √∫rovnƒõ",
    achievement1000Coins: "Tis√≠covka",
    achievement1000CoinsDesc: "Nasb√≠rejte 1000 minc√≠",
    achievement50Upgrades: "Vylep≈°ovatel",
    achievement50UpgradesDesc: "Kupte 50 vylep≈°en√≠",
    achievementPetCollector: "Sbƒõratel mazl√≠ƒçk≈Ø",
    achievementPetCollectorDesc: "Seberte v≈°echny mazl√≠ƒçky",
    // –ù–û–í–û–ï: –ø–µ—Ä–µ–≤–æ–¥—ã –¥–ª—è —É–ª—É—á—à–µ–Ω–∏–π
    upgradeBuy: "Koupit",
    upgradeInProgress: "N√°kup...",
    upgradePurchased: "Koupeno",
    // –ù–û–í–û–ï: –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–µ —Ç–µ–∫—Å—Ç—ã –¥–ª—è —è–π—Ü–∞
    petEgg: "Koupit vejce",
    eggPurchaseFailed: "Pot≈ôebujete {coins} minc√≠",
  }
};

// –ù–û–í–û–ï: –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–π
const ACHIEVEMENTS = [
  { 
    id: 'first_click', 
    name: 'achievementFirstClick', 
    desc: 'achievementFirstClickDesc', 
    condition: () => state.stats.tries >= 1, 
    reward: 50 
  },
  { 
    id: 'lvl5', 
    name: 'achievementLvl5', 
    desc: 'achievementLvl5Desc', 
    condition: () => state.lvl >= 5, 
    reward: 200 
  },
  { 
    id: '1000_coins', 
    name: 'achievement1000Coins', 
    desc: 'achievement1000CoinsDesc', 
    condition: () => state.coins >= 1000, 
    reward: 300 
  },
  { 
    id: '50_upgrades', 
    name: 'achievement50Upgrades', 
    desc: 'achievement50UpgradesDesc', 
    condition: () => Object.keys(state.upgradesUnlocked).length >= 50, 
    reward: 500 
  },
  { 
    id: 'pet_collector', 
    name: 'achievementPetCollector', 
    desc: 'achievementPetCollectorDesc', 
    condition: () => {
      const hatchedPets = Object.values(state.pets).filter(p => p.hatched).length;
      return hatchedPets >= PETS.length;
    }, 
    reward: 1000 
  }
];

const defaultState = {
  coins:0, lvl:1, xp:0, xpToNext:120, pps:0, rarePct:2, mult:1,
  inventory:{}, upgradesUnlocked:{}, upgradesInProgress:{}, stats:{tries:0,rare:0,epic:0,passive:0},
  autoOpenerLevel:0, autoEnabled:false, tryCooldownUntil:0, cooldownReductionMs:0,
  eventUntil:0, eventCooldownUntil:0,
  // –ù–û–í–û–ï: —Å–æ—Å—Ç–æ—è–Ω–∏–µ –Ω–æ–≤–æ–≥–æ —Å–æ–±—ã—Ç–∏—è –∏ –º–∞–≥–∞–∑–∏–Ω–∞
  newEventUntil:0,
  newEventCooldownUntil:0,
  eventShopPurchased: {}, // –∫—É–ø–ª–µ–Ω–Ω—ã–µ –ø—Ä–µ–¥–º–µ—Ç—ã
  // –ù–û–í–û–ï: —Å–æ—Å—Ç–æ—è–Ω–∏–µ –ø–∏—Ç–æ–º—Ü–µ–≤
  pets: {}, // {petId: { purchased: true, hatched: false }}
  selectedPets: [], // –º–∞—Å—Å–∏–≤ –¥–æ 2 —ç–ª–µ–º–µ–Ω—Ç–æ–≤
  quest: { id:'q1', type:'clicks', progress:0, goal:10, reward:15 },
  // –ù–û–í–û–ï: —è–∑—ã–∫ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
  lang: 'ru',
  // –ù–û–í–û–ï: –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è
  achievements: {}
};

let state = loadState();
let lang = state.lang || 'ru'; // –¢–µ–∫—É—â–∏–π —è–∑—ã–∫

// ---------- DOM refs ----------
const coinsEl = document.getElementById('coins');
const lvlEl = document.getElementById('lvl');
const ppsEl = document.getElementById('pps');
const rarePctEl = document.getElementById('rarePct');
const multEl = document.getElementById('mult');
const petMultEl = document.getElementById('petMult'); // –ù–û–í–û–ï
const feedEl = document.getElementById('feed');
const upgradesGrid = document.getElementById('upgradesGrid');
const eventShopGrid = document.getElementById('eventShopGrid');
const petsShopGrid = document.getElementById('petsShopGrid'); // –ù–û–í–û–ï
const petsShopSection = document.getElementById('petsShopSection'); // –ù–û–í–û–ï
const eventShopSection = document.getElementById('eventShopSection');
const invEl = document.getElementById('inventory');
const xpbar = document.getElementById('xpbar');
const tryBtn = document.getElementById('tryBtn');
const spinBtn = document.getElementById('spinWheel');
const toggleAutoBtn = document.getElementById('toggleAuto');
const toast = document.getElementById('toast');
const eventBtn = document.getElementById('eventBtn');
const newEventBtn = document.getElementById('newEventBtn');
const petsBtn = document.getElementById('petsBtn'); // –ù–û–í–û–ï
const eventStatus = document.getElementById('eventStatus');
const questArea = document.getElementById('questArea');
const exportBtn = document.getElementById('exportState');
const importBtn = document.getElementById('importState');
const resetBtn = document.getElementById('resetAll');
const langBtns = document.querySelectorAll('.lang-btn');
// –ù–û–í–û–ï: –ø–∏—Ç–æ–º—Ü—ã
const petSlot1 = document.getElementById('petSlot1');
const petSlot2 = document.getElementById('petSlot2');
const petModal = document.getElementById('petModal');
const petInventoryGrid = document.getElementById('petInventoryGrid');
const closePetModal = document.getElementById('closePetModal');
const savePetsBtn = document.getElementById('savePetsBtn');
const mobileMenuBtn = document.getElementById('mobileMenuBtn');
const sidePanel = document.getElementById('sidePanel');
// –ù–û–í–û–ï: –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è
const achievementsSection = document.getElementById('achievementsSection');
const achievementsList = document.getElementById('achievementsList');
const achievementsCounter = document.getElementById('achievementsCounter');

// ---------- helpers ----------
function loadState(){
  try {
    const raw = localStorage.getItem(STORAGE_KEY);
    if(!raw) return JSON.parse(JSON.stringify(defaultState));
    return {...JSON.parse(JSON.stringify(defaultState)), ...JSON.parse(raw)};
  } catch(e) {
    return JSON.parse(JSON.stringify(defaultState));
  }
}
function saveState(){ 
  localStorage.setItem(STORAGE_KEY, JSON.stringify(state)); 
  // –°–æ—Ö—Ä–∞–Ω—è–µ–º —è–∑—ã–∫
  state.lang = lang;
}
function deepClone(o){ return JSON.parse(JSON.stringify(o)); }
function randInt(min,max){ return Math.floor(min + Math.random()*(max-min+1)); }
function randFloat(min,max){ return Math.random() * (max - min) + min; }
function clamp(v,a,b){ return Math.max(a, Math.min(b, v)); }
function showToast(msg, ms=1200){ toast.textContent = msg; toast.style.display = 'block'; setTimeout(()=> toast.style.display='none', ms); }
function renderFeed(msg){ const d=document.createElement('div'); d.className='item'; d.innerHTML=`<div style="flex:1"><div style="font-weight:700">${msg}</div><div class="small">${new Date().toLocaleTimeString()}</div></div>`; feedEl.prepend(d); while(feedEl.children.length>200) feedEl.removeChild(feedEl.lastChild); }
function showFeed(msg, ms=1200){ renderFeed(msg); showToast(msg, ms); }

// –ù–û–í–û–ï: —Ñ—É–Ω–∫—Ü–∏—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–π
function checkAchievements() {
  let newAchievements = 0;
  
  ACHIEVEMENTS.forEach(ach => {
    // –ï—Å–ª–∏ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–µ —É–∂–µ –ø–æ–ª—É—á–µ–Ω–æ, –ø—Ä–æ–ø—É—Å–∫–∞–µ–º
    if (state.achievements?.[ach.id]) return;
    
    // –ü—Ä–æ–≤–µ—Ä—è–µ–º —É—Å–ª–æ–≤–∏–µ
    if (ach.condition()) {
      // –û—Ç–º–µ—á–∞–µ–º –∫–∞–∫ –ø–æ–ª—É—á–µ–Ω–Ω–æ–µ
      state.achievements = state.achievements || {};
      state.achievements[ach.id] = true;
      
      // –î–æ–±–∞–≤–ª—è–µ–º –Ω–∞–≥—Ä–∞–¥—É
      state.coins += ach.reward;
      
      // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
      const t = translations[lang];
      const name = t[ach.name];
      const desc = t[ach.desc];
      
      showFeed(`üèÜ –î–û–°–¢–ò–ñ–ï–ù–ò–ï: ${name}! +${ach.reward} –º–æ–Ω–µ—Ç`);
      showToast(`–î–æ—Å—Ç–∏–∂–µ–Ω–∏–µ –ø–æ–ª—É—á–µ–Ω–æ: ${name}`, 2500);
      
      // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∞–Ω–∏–º–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ —Å–≤–µ—Ä—Ö—É
      const achievementEl = document.createElement('div');
      achievementEl.className = 'achievement-notification';
      achievementEl.innerHTML = `üèÜ <b>${name}</b>: ${desc} (+${ach.reward} –º–æ–Ω.)`;
      document.body.appendChild(achievementEl);
      
      setTimeout(() => {
        achievementEl.style.opacity = '0';
        setTimeout(() => achievementEl.remove(), 1000);
      }, 3000);
      
      newAchievements++;
    }
  });
  
  if (newAchievements > 0) {
    saveState();
    renderAchievements();
  }
}

// –ù–û–í–û–ï: –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–π
function renderAchievements() {
  if (!achievementsList) return;
  
  // –°—á–∏—Ç–∞–µ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ–ª—É—á–µ–Ω–Ω—ã—Ö –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–π
  const completed = Object.keys(state.achievements || {}).length;
  const total = ACHIEVEMENTS.length;
  
  // –û–±–Ω–æ–≤–ª—è–µ–º —Å—á–µ—Ç—á–∏–∫
  achievementsCounter.textContent = `(${completed}/${total})`;
  
  // –û—á–∏—â–∞–µ–º —Å–ø–∏—Å–æ–∫
  achievementsList.innerHTML = '';
  
  // –î–æ–±–∞–≤–ª—è–µ–º –∫–∞–∂–¥–æ–µ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–µ
  ACHIEVEMENTS.forEach(ach => {
    const isCompleted = state.achievements?.[ach.id];
    const t = translations[lang];
    
    const item = document.createElement('div');
    item.className = `achievement-item ${isCompleted ? 'achievement-completed' : ''}`;
    item.innerHTML = `
      <div class="achievement-icon">${isCompleted ? '‚úì' : 'üèÜ'}</div>
      <div class="achievement-info">
        <div class="name">${t[ach.name]}</div>
        <div class="desc">${t[ach.desc]}</div>
      </div>
      <div class="achievement-reward">+${ach.reward} –º–æ–Ω.</div>
    `;
    
    achievementsList.appendChild(item);
  });
}

// ---------- –ù–û–í–û–ï: –ø–µ—Ä–µ–≤–æ–¥ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞ ----------
function updateLanguage() {
  const t = translations[lang];
  
  document.querySelector('.title').textContent = t.title;
  document.querySelector('.small').textContent = t.subtitle;
  document.querySelectorAll('.stat .small')[0].textContent = t.coins;
  document.querySelectorAll('.stat .small')[1].textContent = t.level;
  document.querySelectorAll('.stat .small')[2].textContent = t.passive;
  
  tryBtn.textContent = t.tryBtn;
  spinBtn.textContent = t.spinWheel;
  toggleAutoBtn.textContent = t.auto + ': ' + (state.autoEnabled ? '–≤–∫–ª' : '–≤—ã–∫–ª');
  
  document.querySelector('.small').textContent = t.xpToLevel;
  document.querySelectorAll('.section strong')[0].textContent = t.quest;
  document.querySelectorAll('.section strong')[1].textContent = t.events;
  document.querySelectorAll('.small')[1].textContent = t.eventDesc;
  eventBtn.textContent = t.eventBtn1;
  newEventBtn.textContent = t.eventBtn2;
  petsBtn.textContent = t.petsBtn; // –ù–û–í–û–ï
  
  if(!isEventActive() && !isNewEventActive()) {
    eventStatus.textContent = t.noEventActive;
  }
  
  document.querySelectorAll('.section strong')[3].textContent = t.eventShopTitle;
  document.querySelectorAll('.small')[3].textContent = t.eventShopDesc;
  
  // –ù–û–í–û–ï: –ø–µ—Ä–µ–≤–æ–¥ –º–∞–≥–∞–∑–∏–Ω–∞ –ø–∏—Ç–æ–º—Ü–µ–≤
  document.querySelectorAll('.section strong')[4].textContent = t.petsShopTitle;
  document.querySelectorAll('.small')[4].textContent = t.petsShopDesc;
  
  // –ù–û–í–û–ï: –ø–µ—Ä–µ–≤–æ–¥ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–π
  document.querySelectorAll('.section strong')[5].textContent = t.achievements;
  document.querySelectorAll('.small')[4].textContent = t.achievementsDesc;
  
  document.querySelectorAll('.section strong')[6].textContent = t.inventory;
  document.querySelectorAll('.section strong')[7].textContent = t.upgrades;
  document.querySelectorAll('.section strong')[8].textContent = t.stats;
  
  document.querySelectorAll('.small')[5].textContent = t.controls;
  exportBtn.textContent = t.exportBtn;
  importBtn.textContent = t.importBtn;
  resetBtn.textContent = t.resetBtn;
  
  document.querySelector('.footer').textContent = t.footer;
  document.querySelectorAll('.small')[6].textContent = t.rareChance;
  document.querySelectorAll('.small')[7].textContent = t.multiplier;
  document.querySelectorAll('.small')[8].textContent = t.passive;
  
  // –û–±–Ω–æ–≤–ª—è–µ–º –∞–∫—Ç–∏–≤–Ω—ã–π —è–∑—ã–∫ –≤ –∫–Ω–æ–ø–∫–∞—Ö
  langBtns.forEach(btn => {
    btn.classList.toggle('active', btn.dataset.lang === lang);
  });
  
  // –ù–û–í–û–ï: –æ–±–Ω–æ–≤–ª—è–µ–º —Ç–µ–∫—Å—Ç—ã –≤ –ø–∏—Ç–æ–º—Ü–∞—Ö
  renderPetsShop();
  renderPetSlots();
  renderPetModal();
  renderAchievements(); // –ù–û–í–û–ï: –æ–±–Ω–æ–≤–ª—è–µ–º –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è
}

// –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —è–∑—ã–∫ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
updateLanguage();

// –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è –∫–Ω–æ–ø–æ–∫ —è–∑—ã–∫–∞
langBtns.forEach(btn => {
  btn.onclick = () => {
    lang = btn.dataset.lang;
    state.lang = lang;
    saveState();
    updateLanguage();
    showFeed(`–Ø–∑—ã–∫ –∏–∑–º–µ–Ω–µ–Ω –Ω–∞ ${lang === 'ru' ? '–†—É—Å—Å–∫–∏–π' : lang === 'en' ? 'English' : 'ƒåe≈°tina'}`);
  };
});

// ---------- CD logic ----------
function effectiveCooldownMs(){ return Math.max(MIN_COOLDOWN_MS, BASE_COOLDOWN_MS - (state.cooldownReductionMs || 0)); }
function setTryCooldown(ms){ state.tryCooldownUntil = Date.now() + ms; saveState(); updateTryButton(); if(window._cdInterval) clearInterval(window._cdInterval); window._cdInterval = setInterval(()=>{ updateTryButton(); if(Date.now() >= (state.tryCooldownUntil || 0)){ clearInterval(window._cdInterval); window._cdInterval = null; } }, 200); }
function isTryOnCooldown(){ return Date.now() < (state.tryCooldownUntil || 0); }
function updateTryButton(){ if(isTryOnCooldown()){ const left = Math.ceil(((state.tryCooldownUntil||0) - Date.now())/1000); tryBtn.disabled = true; tryBtn.textContent = `–ü–æ–¥–æ–∂–¥–∏—Ç–µ ${left}s`; } else { tryBtn.disabled = false; tryBtn.textContent = translations[lang].tryBtn; } }

// ---------- Upgrades generation ----------
const UPGRADE_COUNT = 100;
const upgrades = [];
(function genUpgrades(){
  for(let i=1;i<=UPGRADE_COUNT;i++){
    let tier='small';
    if(i%10===0) tier='large';
    else if(i%3===0) tier='medium';
    const id = 'u'+i;
    const name = `${tier==='large'?'–í–µ–ª–∏–∫–∏–π':'–£–ª—É—á—à–µ–Ω–∏–µ'} #${i}`;
    const timerBase = (tier==='large') ? 5000 : Math.max(1000, 5000 - i*30);
    
    // –ù–û–í–û–ï: —É–≤–µ–ª–∏—á–µ–Ω—ã —Ü–µ–Ω—ã –Ω–∞ 25%
    const cost = Math.round((i*12) * (tier==='large'?6.25: tier==='medium'?2.5:1.25));
    
    let effect;
    // –ù–û–í–û–ï: —É—Å–∏–ª–µ–Ω—ã —ç—Ñ—Ñ–µ–∫—Ç—ã –Ω–∞ 50%
    if(i % 11 === 0) effect = {type:'item', id:'wheel_ticket', qty:(tier==='large'?4:1)};
    else if(i % 7 === 0) effect = {type:'pps', val:(tier==='large'?6: tier==='medium'?1.8:0.22)};
    else if(i % 5 === 0) effect = {type:'rare', val:(tier==='large'?4.5: tier==='medium'?1.5:0.3)};
    else if(i % 3 === 0) effect = {type:'mult', val:(tier==='large'?0.75: tier==='medium'?0.18:0.03)};
    else { const val = (tier==='large'?1500: tier==='medium'?375:150); effect = {type:'cd', val}; }
    
    upgrades.push({id,name,tier,timerBase,cost,effect,description:effectDesc(effect)});
  }
  // –ù–û–í–û–ï: —É—Å–∏–ª–µ–Ω –∞–≤—Ç–æ–ø–æ–≤—Ç–æ—Ä
  upgrades.unshift({ 
    id:'auto_opener', 
    name:'–ê–≤—Ç–æ–ø–æ–≤—Ç–æ—Ä (–∞–ø–≥—Ä–µ–π–¥)', 
    tier:'special', 
    timerBase:0, 
    cost:500, // +100 –º–æ–Ω–µ—Ç
    effect:{type:'auto', val:1}, 
    description:'–ü–æ–∫—É–ø–∞–µ–º—ã–π –∞–≤—Ç–æ–ø–æ–≤—Ç–æ—Ä. –ö–∞–∂–¥—ã–π —É—Ä–æ–≤–µ–Ω—å —É–º–µ–Ω—å—à–∞–µ—Ç –∏–Ω—Ç–µ—Ä–≤–∞–ª –∞–≤—Ç–æ.' 
  });
})();
function effectDesc(e){ 
  if(!e||!e.type) return '–ë–æ–Ω—É—Å'; 
  switch(e.type){ 
    case 'cd': return `–°–æ–∫—Ä–∞—â–∞–µ—Ç CD –Ω–∞ ${e.val/1000}s`; 
    case 'mult': return `–£–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç –º–Ω–æ–∂–∏—Ç–µ–ª—å –Ω–∞ ${(e.val*100).toFixed(0)}%`; 
    case 'rare': return `+${e.val}% –∫ —à–∞–Ω—Å—É —Ä–µ–¥–∫–∏—Ö`; 
    case 'pps': return `–ü–∞—Å—Å–∏–≤ +${e.val}/—Å`; 
    case 'item': return `–î–∞–µ—Ç ${e.id} x${e.qty||1}`; 
    case 'auto': return '–£—Ä–æ–≤–µ–Ω—å –∞–≤—Ç–æ–ø–æ–≤—Ç–æ—Ä–∞'; 
    default: return '–ë–æ–Ω—É—Å'; 
  } 
}

// ---------- Render status/UI ----------
function renderStats(){ 
  coinsEl.textContent = Math.floor(state.coins); 
  lvlEl.textContent = state.lvl; 
  ppsEl.textContent = (state.pps).toFixed(2) + '/s'; 
  rarePctEl.textContent = state.rarePct.toFixed(2) + '%'; 
  multEl.textContent = 'x' + state.mult.toFixed(2); 
  petMultEl.textContent = 'x' + getCurrentPetMultiplier().toFixed(2); 
  const pct = clamp(Math.floor((state.xp/state.xpToNext)*100),0,100); 
  xpbar.style.width = pct + '%'; 
  toggleAutoBtn.textContent = translations[lang].auto + ': ' + (state.autoEnabled ? '–≤–∫–ª' : '–≤—ã–∫–ª'); 
  updateTryButton(); 
  renderEventStatus(); 
  renderQuest(); 
}

// ---------- Render all ----------
function renderAll(){ 
  renderUpgrades(); 
  renderStats(); 
  renderInventory(); 
  renderEventShop();
  renderPetsShop(); // –ù–û–í–û–ï
  renderPetSlots(); // –ù–û–í–û–ï
  renderAchievements(); // –ù–û–í–û–ï: –æ—Ç–æ–±—Ä–∞–∂–∞–µ–º –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è
}

// ---------- –ù–û–í–û–ï: –ü–∏—Ç–æ–º—Ü—ã ----------
function getCurrentPetMultiplier() {
  if (state.selectedPets.length === 0) return 1;
  if (state.selectedPets.length === 1) {
    const pet = PETS.find(p => p.id === state.selectedPets[0]);
    return pet ? pet.multiplier : 1;
  }
  const pet1 = PETS.find(p => p.id === state.selectedPets[0]);
  const pet2 = PETS.find(p => p.id === state.selectedPets[1]);
  return (pet1 ? pet1.multiplier : 1) * (pet2 ? pet2.multiplier : 1);
}

function buyPet(petId) {
  const pet = PETS.find(p => p.id === petId);
  if (!pet) return;
  
  if (state.coins < pet.cost) {
    showToast(`–ù—É–∂–Ω–æ ${pet.cost.toLocaleString()} –º–æ–Ω–µ—Ç!`);
    return;
  }
  
  // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –Ω–µ –∫—É–ø–ª–µ–Ω –ª–∏ —É–∂–µ
  if (state.pets[petId] && state.pets[petId].purchased) {
    showToast('–ü–∏—Ç–æ–º–µ—Ü —É–∂–µ –∫—É–ø–ª–µ–Ω');
    return;
  }
  
  // –ü–æ–∫—É–ø–∞–µ–º
  state.coins -= pet.cost;
  state.pets[petId] = { purchased: true, hatched: true };
  
  saveState();
  renderAll();
  showFeed(`${translations[lang].petBought} ‚Äî ${pet.name}!`);
  showToast(`–ü–æ–∑–¥—Ä–∞–≤–ª—è—é! –ü–æ–ª—É—á–µ–Ω: ${pet.name}`, 2000);
  
  // –ù–û–í–û–ï: –ø—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–π
  checkAchievements();
}

// –ù–û–í–û–ï: —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Å–ª—É—á–∞–π–Ω–æ–≥–æ –ø–∏—Ç–æ–º—Ü–∞ –ø–æ —à–∞–Ω—Å–∞–º
function getRandomPetByChances() {
  const t = translations[lang];
  const total = 100;
  const roll = Math.random() * total;
  
  let cumulative = 0;
  
  // –ü—Ä–æ–≤–µ—Ä—è–µ–º –ª–µ–≥–µ–Ω–¥–∞—Ä–Ω—ã—Ö
  cumulative += EGG_HATCH_CHANCES.legendary;
  if (roll < cumulative) {
    const legendaryPets = PETS.filter(p => p.rarity === 'legendary');
    if (legendaryPets.length > 0) {
      return legendaryPets[randInt(0, legendaryPets.length - 1)];
    }
  }
  
  // –ü—Ä–æ–≤–µ—Ä—è–µ–º —ç–ø–∏—á–µ—Å–∫–∏—Ö
  cumulative += EGG_HATCH_CHANCES.epic;
  if (roll < cumulative) {
    const epicPets = PETS.filter(p => p.rarity === 'epic');
    if (epicPets.length > 0) {
      return epicPets[randInt(0, epicPets.length - 1)];
    }
  }
  
  // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ä–µ–¥–∫–∏—Ö
  cumulative += EGG_HATCH_CHANCES.rare;
  if (roll < cumulative) {
    const rarePets = PETS.filter(p => p.rarity === 'rare');
    if (rarePets.length > 0) {
      return rarePets[randInt(0, rarePets.length - 1)];
    }
  }
  
  // –ü—Ä–æ–≤–µ—Ä—è–µ–º –æ–±—ã—á–Ω—ã—Ö
  cumulative += EGG_HATCH_CHANCES.common;
  if (roll < cumulative) {
    const commonPets = PETS.filter(p => p.rarity === 'common');
    if (commonPets.length > 0) {
      return commonPets[randInt(0, commonPets.length - 1)];
    }
  }
  
  // –ï—Å–ª–∏ –Ω–µ –ø–æ–¥–æ—à–µ–ª –Ω–∏ –æ–¥–∏–Ω (–Ω–∞ —Å–ª—É—á–∞–π, –µ—Å–ª–∏ –Ω–µ—Ç –ø–∏—Ç–æ–º—Ü–µ–≤ –Ω—É–∂–Ω–æ–π —Ä–µ–¥–∫–æ—Å—Ç–∏)
  return null;
}

// –ù–û–í–û–ï: —Ñ—É–Ω–∫—Ü–∏—è –ø–æ–∫—É–ø–∫–∏ —è–π—Ü–∞
function buyPetEgg() {
  const t = translations[lang];
  const eggCost = 500; // –¶–µ–Ω–∞ —è–π—Ü–∞
  
  // –ù–û–í–û–ï: –ø—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞–ª–∏—á–∏—è –º–æ–Ω–µ—Ç –ø–µ—Ä–µ–¥ –ø–æ–∫—É–ø–∫–æ–π
  if (state.coins < eggCost) {
    showToast(t.eggPurchaseFailed.replace('{coins}', eggCost.toLocaleString()));
    return;
  }
  
  // –ü–æ–∫—É–ø–∞–µ–º —è–π—Ü–æ
  state.coins -= eggCost;
  saveState();
  renderAll();
  
  showFeed(t.eggBought);
  showToast(t.eggBought, 2000);
  
  // –ó–∞–ø—É—Å–∫–∞–µ–º –ø—Ä–æ—Ü–µ—Å—Å –≤—ã–ª—É–ø–ª–µ–Ω–∏—è —á–µ—Ä–µ–∑ 2 —Å–µ–∫—É–Ω–¥—ã
  setTimeout(() => {
    const hatchedPet = getRandomPetByChances();
    
    if (!hatchedPet) {
      showFeed(t.eggNoHatchMsg);
      return;
    }
    
    // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –Ω–µ –∫—É–ø–ª–µ–Ω –ª–∏ —É–∂–µ —ç—Ç–æ—Ç –ø–∏—Ç–æ–º–µ—Ü
    if (state.pets[hatchedPet.id] && state.pets[hatchedPet.id].purchased) {
      const refund = Math.floor(hatchedPet.cost * 0.2);
      state.coins += refund;
      saveState();
      renderStats();
      
      showFeed(`${t.eggDuplicate} ‚Äî ${hatchedPet.name}!`);
      showToast(`${t.eggRefund.replace('{coins}', refund.toLocaleString())}`, 1500);
    } else {
      // –ü–æ–∫—É–ø–∞–µ–º –ø–∏—Ç–æ–º—Ü–∞
      state.pets[hatchedPet.id] = { purchased: true, hatched: true };
      saveState();
      renderAll();
      showFeed(`‚ú® ${t.eggHatched}: ${hatchedPet.name}!`);
      showToast(`–ò–∑ —è–π—Ü–∞ –≤—ã–ª—É–ø–∏–ª—Å—è ${hatchedPet.name}!`, 2000);
      
      // –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–π
      checkAchievements();
    }
  }, 2000);
}

function renderPetsShop() {
  petsShopGrid.innerHTML = '';
  
  // –î–æ–±–∞–≤–ª—è–µ–º —è–π—Ü–æ —Å —à–∞–Ω—Å–∞–º–∏
  const eggEl = document.createElement('div');
  eggEl.className = 'pet-shop-item';
  eggEl.innerHTML = `
    <div class="pet-icon">ü•ö</div>
    <div class="name">${translations[lang].petEgg}</div>
    <div class="rarity">${translations[lang].eggChancesTitle}</div>
    <div class="egg-chances">
      <div class="egg-chance common-chance">${translations[lang].eggCommon}</div>
      <div class="egg-chance rare-chance">${translations[lang].eggRare}</div>
      <div class="egg-chance epic-chance">${translations[lang].eggEpic}</div>
      <div class="egg-chance legendary-chance">${translations[lang].eggLegendary}</div>
      <div class="egg-chance">${translations[lang].eggNoHatch}</div>
    </div>
    <div class="cost">
      <div style="width:20px;height:20px;background:linear-gradient(180deg,#ffd166,#ffa500);border-radius:50%"></div>
      <div>500 –º–æ–Ω.</div>
    </div>
    <button class="btn-ghost">${translations[lang].petEgg}</button>
  `;
  
  const eggBtn = eggEl.querySelector('button');
  eggBtn.onclick = buyPetEgg;
  
  petsShopGrid.appendChild(eggEl);
  
  // –û—Ç–æ–±—Ä–∞–∂–∞–µ–º —É–∂–µ –∫—É–ø–ª–µ–Ω–Ω—ã—Ö –ø–∏—Ç–æ–º—Ü–µ–≤
  PETS.forEach(pet => {
    const isPurchased = state.pets[pet.id] && state.pets[pet.id].purchased;
    const isHatched = isPurchased && state.pets[pet.id].hatched;
    
    if (!isHatched) return;
    
    const el = document.createElement('div');
    el.className = `pet-shop-item ${isPurchased ? 'purchased' : ''} ${isHatched ? 'hatched' : ''} ${pet.rarity}`;
    el.innerHTML = `
      <div class="pet-icon">${pet.icon}</div>
      <div class="name">${pet.name}</div>
      <div class="rarity">${pet.desc}</div>
      <div class="cost">
        <div style="width:20px;height:20px;background:linear-gradient(180deg,#ffd166,#ffa500);border-radius:50%"></div>
        <div>${pet.cost.toLocaleString()} –º–æ–Ω.</div>
      </div>
      <button class="btn-ghost">${isPurchased ? translations[lang].upgradePurchased : translations[lang].upgradeBuy}</button>
    `;
    
    const btn = el.querySelector('button');
    btn.onclick = () => buyPet(pet.id);
    
    petsShopGrid.appendChild(el);
  });
}

function renderPetSlots() {
  // –û—á–∏—â–∞–µ–º —Å–ª–æ—Ç—ã
  petSlot1.innerHTML = '';
  petSlot2.innerHTML = '';
  petSlot1.className = 'pet-slot';
  petSlot2.className = 'pet-slot';
  
  // –ó–∞–ø–æ–ª–Ω—è–µ–º —Å–ª–æ—Ç—ã –≤—ã–±—Ä–∞–Ω–Ω—ã–º–∏ –ø–∏—Ç–æ–º—Ü–∞–º–∏
  if (state.selectedPets.length > 0) {
    const pet1 = PETS.find(p => p.id === state.selectedPets[0]);
    if (pet1) {
      petSlot1.innerHTML = pet1.icon;
      petSlot1.classList.add('selected');
    }
  }
  
  if (state.selectedPets.length > 1) {
    const pet2 = PETS.find(p => p.id === state.selectedPets[1]);
    if (pet2) {
      petSlot2.innerHTML = pet2.icon;
      petSlot2.classList.add('selected');
    }
  }
}

function renderPetModal() {
  petInventoryGrid.innerHTML = '';
  
  PETS.forEach(pet => {
    const isPurchased = state.pets[pet.id] && state.pets[pet.id].purchased;
    const isHatched = isPurchased && state.pets[pet.id].hatched;
    const isSelected = state.selectedPets.includes(pet.id);
    
    if (!isPurchased || !isHatched) return;
    
    const el = document.createElement('div');
    el.className = `pet-shop-item ${pet.rarity} ${isSelected ? 'selected' : ''}`;
    el.innerHTML = `
      <div class="pet-icon">${pet.icon}</div>
      <div class="name">${pet.name}</div>
      <div class="rarity">${pet.desc} (x${pet.multiplier})</div>
      <div style="text-align:center;margin-top:4px">
        <button class="btn-ghost" style="padding:4px 8px;font-size:12px">
          ${isSelected ? '–£–±—Ä–∞—Ç—å' : '–í—ã–±—Ä–∞—Ç—å'}
        </button>
      </div>
    `;
    
    const btn = el.querySelector('button');
    btn.onclick = () => togglePetSelection(pet.id);
    
    petInventoryGrid.appendChild(el);
  });
}

function togglePetSelection(petId) {
  // –ï—Å–ª–∏ –ø–∏—Ç–æ–º–µ—Ü –Ω–µ –∫—É–ø–ª–µ–Ω –∏–ª–∏ –Ω–µ –≤—ã–ª—É–ø–∏–ª—Å—è, –≤—ã—Ö–æ–¥–∏–º
  if (!state.pets[petId] || !state.pets[petId].purchased || !state.pets[petId].hatched) {
    return;
  }
  
  const index = state.selectedPets.indexOf(petId);
  
  if (index > -1) {
    // –£–¥–∞–ª—è–µ–º –∏–∑ –≤—ã–±–æ—Ä–∞
    state.selectedPets.splice(index, 1);
  } else {
    // –î–æ–±–∞–≤–ª—è–µ–º –≤ –≤—ã–±–æ—Ä (–º–∞–∫—Å–∏–º—É–º 2)
    if (state.selectedPets.length < 2) {
      state.selectedPets.push(petId);
    } else {
      showToast(translations[lang].petMax);
    }
  }
  
  renderPetModal();
}

function savePetSelection() {
  saveState();
  renderAll();
  petModal.style.display = 'none';
  showFeed(translations[lang].petActivated);
}

// –ù–û–í–û–ï: —Ñ—É–Ω–∫—Ü–∏–∏ –¥–ª—è –Ω–æ–≤–æ–≥–æ —Å–æ–±—ã—Ç–∏—è
function isNewEventActive(){ return Date.now() < (state.newEventUntil || 0); }
function isNewEventCooling(){ return Date.now() < (state.newEventCooldownUntil || 0); }

// activateEvent source: 'manual' or 'auto'
function activateEvent(source='manual'){
  if(isEventActive() || isEventCooling()) return false;
  state.eventUntil = Date.now() + EVENT_DURATION_MS;
  state.eventCooldownUntil = state.eventUntil + EVENT_COOLDOWN_MS;
  saveState();
  showFeed(`${translations[lang].eventBtn1} –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω${source==='auto'?' –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏!':''} ‚Äî x2 –º–æ–Ω–µ—Ç—ã ${EVENT_DURATION_MS/1000}s`);
  renderEventStatus();
  // ensure periodic UI updates
  if(window._eventInterval) clearInterval(window._eventInterval);
  window._eventInterval = setInterval(renderEventStatus, 500);
  return true;
}

// –ù–û–í–û–ï: –∞–∫—Ç–∏–≤–∞—Ü–∏—è –Ω–æ–≤–æ–≥–æ —Å–æ–±—ã—Ç–∏—è
function activateNewEvent(source='manual'){
  if(isNewEventActive() || isNewEventCooling()) return false;
  state.newEventUntil = Date.now() + NEW_EVENT_DURATION_MS;
  state.newEventCooldownUntil = state.newEventUntil + NEW_EVENT_COOLDOWN_MS;
  saveState();
  showFeed(`${translations[lang].eventBtn2} –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω${source==='auto'?' –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏!':''} ‚Äî –æ—Ç–∫—Ä—ã–≤–∞–π –≠–ü–ò–ß–ù–´–ô –ú–ê–ì–ê–ó–ò–ù!`);
  renderEventStatus();
  renderEventShop(); // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –º–∞–≥–∞–∑–∏–Ω —Å—Ä–∞–∑—É
  
  // –ù–û–í–û–ï: –¥–æ–±–∞–≤–ª–µ–Ω –∏–Ω—Ç–µ—Ä–≤–∞–ª –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å—Ç–∞—Ç—É—Å–∞
  if(window._newEventInterval) clearInterval(window._newEventInterval);
  window._newEventInterval = setInterval(renderEventStatus, 500);
  
  return true;
}

eventBtn.onclick = ()=> { if(activateEvent('manual')) saveState(); };
newEventBtn.onclick = ()=> { if(activateNewEvent('manual')) saveState(); };

// ---------- Auto-opener ----------
let autoInterval = null;
function getAutoInterval(){ const lvl = state.autoOpenerLevel || 0; const reduction = Math.min(0.85, lvl * 0.06); return Math.max(MIN_COOLDOWN_MS, Math.round(BASE_COOLDOWN_MS * (1 - reduction))); }
function ensureAuto(){ if(state.autoEnabled && (state.autoOpenerLevel || 0) > 0){ if(autoInterval) clearInterval(autoInterval); autoInterval = setInterval(()=> tryLuck(), getAutoInterval()); } else { if(autoInterval){ clearInterval(autoInterval); autoInterval = null; } } }

// ---------- Wheel ----------
function spinWheel(){ if(!(state.inventory['wheel_ticket']>0)){ renderFeed('–ù–µ—Ç –±–∏–ª–µ—Ç–∞ –∫–æ–ª–µ—Å–∞'); return; } state.inventory['wheel_ticket'] -= 1; if(state.inventory['wheel_ticket']<=0) delete state.inventory['wheel_ticket']; renderFeed('–ö—Ä—É—Ç–∏–º –∫–æ–ª–µ—Å–æ...'); setTimeout(()=>{ const r = randInt(0,3); if(r===0){ state.coins += 20; renderFeed('–ö–æ–ª–µ—Å–æ: +20'); } else if(r===1){ state.coins += 200; renderFeed('–ö–æ–ª–µ—Å–æ: +200'); } else if(r===2){ state.inventory['–†–µ–¥–∫–∏–π –∞—Ä—Ç–µ—Ñ–∞–∫—Ç'] = (state.inventory['–†–µ–¥–∫–∏–π –∞—Ä—Ç–µ—Ñ–∞–∫—Ç']||0)+1; renderFeed('–ö–æ–ª–µ—Å–æ: —Ä–µ–¥–∫–∏–π –ø—Ä–µ–¥–º–µ—Ç'); } else renderFeed('–ö–æ–ª–µ—Å–æ: –ø—É—Å—Ç–æ'); saveState(); renderAll(); animateCoinsBurst(8); }, 900); }

// ---------- Quest system ----------
function renderQuest(){ if(!state.quest) { questArea.innerHTML = '<div class="small">–ù–µ—Ç –∫–≤–µ—Å—Ç–∞</div>'; return; } const q = state.quest; questArea.innerHTML = `<div class="quest-row"><div><strong>${translations[lang].quest}:</strong> ${qDesc(q)}</div><div><button class="btn-ghost" onclick="claimQuest()">–ü—Ä–æ–≤–µ—Ä–∏—Ç—å</button></div></div>`; }
function qDesc(q){ if(q.type==='clicks') return `–°–¥–µ–ª–∞–π –∫–ª–∏–∫–æ–≤: ${q.progress}/${q.goal} ‚Äî –Ω–∞–≥—Ä–∞–¥–∞ ${q.reward} –º–æ–Ω.`; if(q.type==='upgrade') return `–ö—É–ø–∏ –∞–ø–≥—Ä–µ–π–¥—ã: ${q.progress}/${q.goal} ‚Äî –Ω–∞–≥—Ä–∞–¥–∞ ${q.reward} –º–æ–Ω.`; if(q.type==='money') return `–ù–∞–±–µ—Ä–∏ –º–æ–Ω–µ—Ç: ${Math.floor(state.coins)}/${q.goal} ‚Äî –Ω–∞–≥—Ä–∞–¥–∞ ${q.reward} –º–æ–Ω.`; return `${q.type}: ${q.progress}/${q.goal}`; }
function checkQuestComplete(){ if(!state.quest) return; const q = state.quest; if(q.type==='clicks' && q.progress>=q.goal) completeQuest(); if(q.type==='upgrade' && q.progress>=q.goal) completeQuest(); if(q.type==='money' && state.coins>=q.goal) completeQuest(); }
function completeQuest(){ const q = state.quest; if(!q) return; state.coins += q.reward; showFeed(`–ö–≤–µ—Å—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω! +${q.reward} –º–æ–Ω–µ—Ç`); const templates = [ {type:'clicks', goal:randInt(8,20), reward:Math.round(randInt(10,30))}, {type:'upgrade', goal:1+randInt(0,2), reward:Math.round(randInt(15,40))}, {type:'money', goal:randInt(40,150), reward:Math.round(randInt(20,60))} ]; const pick = templates[randInt(0,templates.length-1)]; state.quest = { id:'q'+Date.now(), type:pick.type, progress:0, goal:pick.goal, reward:pick.reward }; saveState(); renderQuest(); renderStats(); }
function claimQuest(){ checkQuestComplete(); renderQuest(); }

// ---------- Inventory render ----------
function renderInventory(){ invEl.innerHTML=''; const keys = Object.keys(state.inventory); if(keys.length===0){ invEl.innerHTML='<div class="small">–ü—É—Å—Ç–æ</div>'; return; } keys.forEach(k=>{ const el = document.createElement('div'); el.className='inv-item'; el.style.display='flex'; el.style.justifyContent='space-between'; el.style.padding='6px'; el.style.borderRadius='6px'; el.innerHTML=`<div>${k}</div><div>x${state.inventory[k]}</div>`; invEl.appendChild(el); }); }

// ---------- –ù–û–í–û–ï: –≠–ø–∏—á–µ—Å–∫–∏–π –∏–≤–µ–Ω—Ç-–º–∞–≥–∞–∑–∏–Ω ----------
function renderEventShop(){
  if (!eventShopGrid) return; // –ó–∞—â–∏—Ç–∞ –æ—Ç null

  // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –º–∞–≥–∞–∑–∏–Ω —Ç–æ–ª—å–∫–æ –≤–æ –≤—Ä–µ–º—è –ù–û–í–û–ì–û —Å–æ–±—ã—Ç–∏—è
  if(isNewEventActive()){
    eventShopSection.style.display = 'block';
  } else {
    eventShopSection.style.display = 'none';
  }

  eventShopGrid.innerHTML = '';
  EVENT_SHOP_ITEMS.forEach(item => {
    // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –∫—É–ø–ª–µ–Ω –ª–∏ –ø—Ä–µ–¥–º–µ—Ç
    const isPurchased = state.eventShopPurchased[item.id] === true;
    
    const el = document.createElement('div');
    el.className = `event-shop-item ${isPurchased ? 'sold' : ''}`;
    el.innerHTML = `
      <div class="epic-tag">–≠–ü–ò–ö</div>
      <div class="name">${item.name}</div>
      <div class="desc">${item.desc}</div>
      <div class="cost">
        <div style="width:20px;height:20px;background:linear-gradient(180deg,#ffd166,#ffa500);border-radius:50%"></div>
        <div>${item.cost.toLocaleString()} –º–æ–Ω.</div>
      </div>
      <button class="btn-ghost" ${isPurchased ? 'disabled' : ''}>${isPurchased ? translations[lang].upgradePurchased : translations[lang].upgradeBuy} –∑–∞ ${item.cost}</button>
    `;
    
    // –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–ª–∏–∫–∞
    if(!isPurchased) {
      const btn = el.querySelector('button');
      btn.onclick = () => buyEventShopItem(item);
    }
    
    eventShopGrid.appendChild(el);
  });
}

function buyEventShopItem(item){
  if(state.coins < item.cost){
    showToast(`–ù—É–∂–Ω–æ ${item.cost.toLocaleString()} –º–æ–Ω–µ—Ç!`);
    return;
  }
  
  // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –Ω–µ –∫—É–ø–ª–µ–Ω –ª–∏ —É–∂–µ
  if(state.eventShopPurchased[item.id] === true){
    showToast('–ü—Ä–µ–¥–º–µ—Ç —É–∂–µ –∫—É–ø–ª–µ–Ω');
    return;
  }
  
  // –ü–æ–∫—É–ø–∞–µ–º
  state.coins -= item.cost;
  state.eventShopPurchased[item.id] = true;
  
  // –ü—Ä–∏–º–µ–Ω—è–µ–º —ç—Ñ—Ñ–µ–∫—Ç
  applyEffectWithBuff(item.effect);
  
  // –°–æ—Ö—Ä–∞–Ω—è–µ–º –∏ –æ–±–Ω–æ–≤–ª—è–µ–º
  saveState();
  renderAll();
  
  // –≠–ø–∏—á–Ω–∞—è –∞–Ω–∏–º–∞—Ü–∏—è
  animateCoinsBurst(12);
  showFeed(`‚ú® –ü–û–ö–£–ü–ö–ê: ${item.name} ‚Äî ${item.desc}!`);
  showToast(`–ü–æ–∑–¥—Ä–∞–≤–ª—è—é! –ü–æ–ª—É—á–µ–Ω: ${item.name}`, 2000);
}

// ---------- Coins animation ----------
function animateCoinsBurst(count){
  const area = document.querySelector('.play-area'); const rect = area.getBoundingClientRect();
  for(let i=0;i<count;i++){
    const c = document.createElement('div'); c.className='coin-fx';
    const x = randInt(rect.left+40, rect.right-40); const y = randInt(rect.top+40, rect.bottom-40);
    c.style.left = x + 'px'; c.style.top = y + 'px'; c.style.opacity = '1'; document.body.appendChild(c);
    setTimeout(()=>{ const t = coinsEl.getBoundingClientRect(); c.style.transform = `translate(${t.left - x + 10}px, ${t.top - y}px) scale(0.2)`; c.style.opacity='0'; }, 50 + i*15);
    setTimeout(()=> c.remove(), 800 + i*10);
  }
}

// ---------- Try (–ò—Å–ø—ã—Ç–∞—Ç—å —É–¥–∞—á—É) + random event activation ----------
function tryLuck(){
  if(isTryOnCooldown()){ renderFeed('–ü–æ–¥–æ–∂–¥–∏—Ç–µ, –ø–æ–∫–∞ CD –Ω–µ –∑–∞–∫–æ–Ω—á–∏—Ç—Å—è.'); return; }
  setTryCooldown(effectiveCooldownMs());
  state.stats.tries = (state.stats.tries || 0) + 1;
  
  // –ù–û–í–û–ï: –ø—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–π
  checkAchievements();

  // random event chance for EVENT1 (–†–µ–ª–∏–∑–Ω—ã–π —Ñ–µ—Å—Ç–∏–≤–∞–ª—å)
  if(!isEventActive() && !isEventCooling() && !isNewEventActive() && !isNewEventCooling()){
    const chance = randFloat(RANDOM_EVENT_MIN, RANDOM_EVENT_MAX);
    if(Math.random() < chance){
      activateEvent('auto'); // auto-triggered by random chance
    }
  }

  // –ù–û–í–û–ï: –º–Ω–æ–∂–∏—Ç–µ–ª—å –¥–ª—è –Ω–æ–≤–æ–≥–æ —Å–æ–±—ã—Ç–∏—è
  const eventMult = isEventActive() ? 2 : (isNewEventActive() ? 1.5 : 1);
  
  // –ù–û–í–û–ï: –º–Ω–æ–∂–∏—Ç–µ–ª—å –æ—Ç –ø–∏—Ç–æ–º—Ü–µ–≤ (–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ –º–Ω–æ–∂–∏—Ç–µ–ª–µ–π –¥–≤—É—Ö –ø–∏—Ç–æ–º—Ü–µ–≤)
  const petMult = getCurrentPetMultiplier();
  
  // –û–±—â–∏–π –º–Ω–æ–∂–∏—Ç–µ–ª—å
  const totalMult = eventMult * petMult;
  
  // –ù–û–í–û–ï: —à–∞–Ω—Å —Ä–µ–¥–∫–∏—Ö –¥–ª—è –Ω–æ–≤–æ–≥–æ —Å–æ–±—ã—Ç–∏—è
  const rareChance = state.rarePct + (isNewEventActive() ? 3 : 0);
  
  const roll = Math.random() * 100; let base = 0;
  if(roll < rareChance){
    base = randInt(25,90); const tot = Math.floor(base * state.mult * totalMult); state.coins += tot; state.stats.rare = (state.stats.rare||0)+1; renderFeed(`–†–µ–¥–∫–∞—è —É–¥–∞—á–∞! +${tot} –º–æ–Ω–µ—Ç`); if(Math.random()<0.25){ state.inventory['–†–µ–¥–∫–∏–π –∞—Ä—Ç–µ—Ñ–∞–∫—Ç'] = (state.inventory['–†–µ–¥–∫–∏–π –∞—Ä—Ç–µ—Ñ–∞–∫—Ç']||0)+1; renderFeed('–ü–æ–π–º–∞–Ω —Ä–µ–¥–∫–∏–π –∞—Ä—Ç–µ—Ñ–∞–∫—Ç!'); }
  } else if(roll > 99){
    base = randInt(200,800); const tot = Math.floor(base * state.mult * totalMult); state.coins += tot; state.stats.epic = (state.stats.epic||0)+1; renderFeed(`–≠–ø–∏—á–µ—Å–∫–∞—è —É–¥–∞—á–∞! +${tot} –º–æ–Ω–µ—Ç`); state.inventory['–≠–ø–∏—á–µ—Å–∫–∏–π –∞—Ä—Ç–µ—Ñ–∞–∫—Ç'] = (state.inventory['–≠–ø–∏—á–µ—Å–∫–∏–π –∞—Ä—Ç–µ—Ñ–∞–∫—Ç']||0)+1;
  } else {
    base = randInt(1,8); const tot = Math.floor(base * state.mult * totalMult); state.coins += tot; renderFeed(`–û–±—ã—á–Ω—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç: +${tot} –º–æ–Ω–µ—Ç`);
  }

  state.xp += Math.max(1, Math.floor(base/2));
  if(state.xp >= state.xpToNext){ state.xp -= state.xpToNext; state.lvl += 1; state.xpToNext = Math.floor(state.xpToNext * 1.25); renderFeed(`–£—Ä–æ–≤–µ–Ω—å –ø–æ–≤—ã—à–µ–Ω –¥–æ ${state.lvl}`); }

  if(Math.random() < 0.03){ state.inventory['wheel_ticket'] = (state.inventory['wheel_ticket']||0) + 1; renderFeed('–ü–æ–ª—É—á–µ–Ω –±–∏–ª–µ—Ç –∫–æ–ª–µ—Å–∞!'); }

  // quest progress
  if(state.quest){
    if(state.quest.type === 'clicks'){ state.quest.progress++; checkQuestComplete(); }
    if(state.quest.type === 'money'){ if(state.coins >= state.quest.goal) checkQuestComplete(); }
  }

  saveState(); renderAll(); animateCoinsBurst(6);
}

// ---------- Event helpers ----------
function isEventActive(){ return Date.now() < (state.eventUntil || 0); }
function isEventCooling(){ return Date.now() < (state.eventCooldownUntil || 0); }

// ---------- Render status/UI ----------
function renderEventStatus(){
  let statusText = '';
  
  if(isEventActive()){
    const left = Math.ceil((state.eventUntil - Date.now())/1000);
    statusText += `<div>üéâ ${translations[lang].eventBtn1}: ${left}s (x2)</div>`;
    eventBtn.disabled = true;
  } else if(isEventCooling()){
    const left = Math.ceil((state.eventCooldownUntil - Date.now())/1000);
    statusText += `<div class="small">‚è≥ ${translations[lang].eventBtn1}: ${left}s</div>`;
    eventBtn.disabled = true;
  } else {
    eventBtn.disabled = false;
  }
  
  if(isNewEventActive()){
    const left = Math.ceil((state.newEventUntil - Date.now())/1000);
    statusText += `<div style="color:#ff7ec7">‚ú® ${translations[lang].eventBtn2}: ${left}s (–ú–ê–ì–ê–ó–ò–ù –û–¢–ö–†–´–¢!)</div>`;
    newEventBtn.disabled = true;
  } else if(isNewEventCooling()){
    const left = Math.ceil((state.newEventCooldownUntil - Date.now())/1000);
    statusText += `<div class="small">‚è≥ ${translations[lang].eventBtn2}: ${left}s</div>`;
    newEventBtn.disabled = true;
  } else {
    newEventBtn.disabled = false;
  }
  
  if(!statusText) statusText = `<div class="small">${translations[lang].noEventActive}</div>`;
  eventStatus.innerHTML = statusText;
}

// ---------- Render upgrades ----------
function renderUpgrades(){
  upgradesGrid.innerHTML = '';
  upgrades.forEach(u=>{
    const unlocked = !!state.upgradesUnlocked[u.id];
    const inProg = !!state.upgradesInProgress[u.id];
    const meta = state.upgradesInProgress[u.id];
    const remains = inProg ? Math.max(0, meta.endsAt - Date.now()) : 0;
    const total = u.timerBase || 1;
    const filled = inProg ? Math.round((1 - remains/total)*100) : 0;
    const card = document.createElement('div'); card.className='upgrade-card';
    card.innerHTML = `
      <div class="upgrade-top">
        <div style="width:44px;height:44px;border-radius:8px;background:${u.tier==='large'?'linear-gradient(135deg,#ffb84d,#ff7a5a)':'linear-gradient(135deg,#7fd3ff,#5ea6ff)'};display:flex;align-items:center;justify-content:center;font-weight:700">${u.id==='auto_opener'?'A':u.id.replace('u','')}</div>
        <div style="flex:1">
          <div class="upgrade-name">${u.name}</div>
          <div class="upgrade-meta">${u.description}</div>
        </div>
      </div>
      <div style="display:flex;align-items:center;justify-content:space-between">
        <div class="small">–°—Ç–æ–∏–º–æ—Å—Ç—å: ${u.cost} –º–æ–Ω.</div>
        <div class="upgrade-actions">
          <button class="action-btn btn-ghost" data-id="${u.id}" data-action="info">i</button>
          <button class="action-btn open-btn" data-id="${u.id}" ${unlocked||inProg ? 'disabled' : ''}>
            ${unlocked ? translations[lang].upgradePurchased : inProg ? translations[lang].upgradeInProgress : translations[lang].upgradeBuy}
          </button>
        </div>
      </div>
      <div class="progress"><i id="prog-${u.id}" style="width:${filled}%"></i></div>
    `;
    upgradesGrid.appendChild(card);
  });
  
  // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–ª—è –∫–Ω–æ–ø–∫–∏ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏
  upgradesGrid.querySelectorAll('[data-action="info"]').forEach(btn => {
    btn.onclick = () => {
      const id = btn.dataset.id;
      const u = upgrades.find(x => x.id === id);
      if (u) {
        showToast(`${u.name}: ${u.description}`, 1000);
      }
    };
  });
  
  // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–ª—è –∫–Ω–æ–ø–∫–∏ –ø–æ–∫—É–ø–∫–∏
  upgradesGrid.querySelectorAll('.open-btn').forEach(btn => {
    btn.onclick = () => onUpgradeOpen(btn.dataset.id);
  });
}

// ---------- Open upgrade ----------
function onUpgradeOpen(id){
  const u = upgrades.find(x=>x.id===id); if(!u) return;
  if(state.upgradesUnlocked[id]){ showToast(translations[lang].upgradePurchased); return; }
  if(state.upgradesInProgress[id]){ showToast(translations[lang].upgradeInProgress); return; }
  if(state.coins < u.cost){ showToast('–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –º–æ–Ω–µ—Ç'); return; }

  // –ü–û–õ–ù–û–°–¢–¨–Æ –£–ë–†–ê–ù–ê –†–ê–ó–ù–ò–¶–ê –ú–ï–ñ–î–£ "–û–¢–ö–†–´–¢–¨" –ò "–ö–£–ü–ò–¢–¨"
  state.coins -= u.cost; state.upgradesInProgress[id] = {endsAt: Date.now() + u.timerBase}; saveState(); renderUpgrades(); renderStats();
  showFeed(`–ü–æ–∫—É–ø–∫–∞ –∑–∞–ø—É—â–µ–Ω–∞: ${u.name} (${Math.round(u.timerBase/1000)}s)`); startProgressLoop();
}

// ---------- Progress loop ----------
let progressActive = false;
function startProgressLoop(){
  if(progressActive) return; progressActive = true;
  const loop = ()=> {
    const ids = Object.keys(state.upgradesInProgress);
    ids.forEach(id=>{
      const meta = state.upgradesInProgress[id]; const u = upgrades.find(x=>x.id===id); if(!meta||!u) return;
      const total = u.timerBase || 1; const remains = Math.max(0, meta.endsAt - Date.now());
      const progEl = document.getElementById('prog-'+id); if(progEl) progEl.style.width = Math.round((1 - remains/total)*100) + '%';
      if(remains <= 0) finishUpgrade(id);
    });
    if(Object.keys(state.upgradesInProgress).length === 0){ progressActive = false; return; }
    requestAnimationFrame(loop);
  };
  requestAnimationFrame(loop);
}

// ---------- Finish upgrade ----------
function finishUpgrade(id){
  if(!state.upgradesInProgress[id]) return;
  const u = upgrades.find(x=>x.id===id); if(!u){ delete state.upgradesInProgress[id]; saveState(); renderUpgrades(); return; }
  applyEffectWithBuff(u.effect); state.upgradesUnlocked[id] = true; delete state.upgradesInProgress[id];
  // –ù–û–í–û–ï: —Å–∏–ª—å–Ω–µ–µ —É—Å–∫–æ—Ä–µ–Ω–∏–µ —Ç–∞–π–º–µ—Ä–æ–≤
  upgrades.forEach(g=>{ if(g.tier !== 'large' && g.id !== 'auto_opener') g.timerBase = Math.max(700, g.timerBase - 7); });
  saveState(); renderUpgrades(); renderStats(); renderInventory();
  showFeed(`–ö—É–ø–ª–µ–Ω–æ: ${u.name}`); if(u.effect && u.effect.type === 'cd') animateCoinsBurst(10); else animateCoinsBurst(8);
  if(state.quest && state.quest.type === 'upgrade'){ state.quest.progress++; checkQuestComplete(); }
  
  // –ù–û–í–û–ï: –ø—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–π
  checkAchievements();
}

// ---------- Apply effect with small buff ----------
function applyEffectWithBuff(e){
  if(!e) return;
  switch(e.type){
    case 'cd':
      const cdBuff = Math.round((e.val || 0) * 1.10); // +10% –≤–º–µ—Å—Ç–æ 5%
      state.cooldownReductionMs = (state.cooldownReductionMs || 0) + cdBuff;
      state.cooldownReductionMs = Math.min(state.cooldownReductionMs, BASE_COOLDOWN_MS - MIN_COOLDOWN_MS);
      renderFeed(`CD —É–º–µ–Ω—å—à–µ–Ω –Ω–∞ ${(cdBuff/1000).toFixed(2)}s (–∏—Ç–æ–≥–æ ${(state.cooldownReductionMs/1000).toFixed(2)}s)`);
      break;
    case 'mult':
      const multVal = (e.val || 0) * 1.15; // +15% –≤–º–µ—Å—Ç–æ 10%
      state.mult *= (1 + multVal);
      renderFeed(`–ú–Ω–æ–∂–∏—Ç–µ–ª—å +${(multVal*100).toFixed(0)}% (—Ç–µ–∫—É—â–∏–π x${state.mult.toFixed(2)})`);
      break;
    case 'rare':
      const rareVal = (e.val || 0) * 1.15; // +15% –≤–º–µ—Å—Ç–æ 10%
      state.rarePct += rareVal; 
      renderFeed(`–®–∞–Ω—Å —Ä–µ–¥–∫–∏—Ö +${rareVal.toFixed(2)}% (–∏—Ç–æ–≥–æ ${state.rarePct.toFixed(2)}%)`);
      break;
    case 'pps':
      const ppsVal = (e.val || 0) * 1.15; // +15% –≤–º–µ—Å—Ç–æ 10%
      state.pps += ppsVal; 
      renderFeed(`–ü–∞—Å—Å–∏–≤ +${ppsVal.toFixed(2)}/—Å`);
      break;
    case 'item':
      state.inventory[e.id] = (state.inventory[e.id] || 0) + (e.qty || 1); 
      renderFeed(`–ü–æ–ª—É—á–µ–Ω –ø—Ä–µ–¥–º–µ—Ç: ${e.id} x${e.qty || 1}`);
      break;
    default:
      renderFeed('–ü—Ä–∏–º–µ–Ω—ë–Ω –±–æ–Ω—É—Å');
  }
}

// ---------- Background tick (passive income + complete upgrades) ----------
setInterval(()=>{
  if(state.pps > 0){ state.coins += state.pps; state.stats.passive = (state.stats.passive||0) + state.pps; saveState(); }
  const ids = Object.keys(state.upgradesInProgress); ids.forEach(id=>{ if(Date.now() >= state.upgradesInProgress[id].endsAt) finishUpgrade(id); });
  renderStats();
}, 1000);

// ---------- Buttons and bindings ----------
tryBtn.onclick = tryLuck; 
spinBtn.onclick = spinWheel; 
toggleAutoBtn.onclick = ()=>{ 
  state.autoEnabled = !state.autoEnabled; 
  if(state.autoEnabled && (state.autoOpenerLevel||0)===0) showToast('–ö—É–ø–∏ –ê–≤—Ç–æ–ø–æ–≤—Ç–æ—Ä –≤ —É–ª—É—á—à–µ–Ω–∏—è—Ö'); 
  ensureAuto(); 
  saveState(); 
  renderStats(); 
};
petsBtn.onclick = () => { 
  petModal.style.display = 'flex';
  renderPetModal();
};
closePetModal.onclick = () => {
  petModal.style.display = 'none';
};
savePetsBtn.onclick = savePetSelection;
window.addEventListener('keydown', e=>{ 
  if(e.code==='Space') tryLuck(); 
  if(e.key.toLowerCase()==='s'){ 
    const f = upgrades.find(x=>x.tier==='small' && !state.upgradesUnlocked[x.id] && !state.upgradesInProgress[x.id]); 
    if(f) onUpgradeOpen(f.id); 
  } 
});
exportBtn.onclick = ()=>{ 
  try{ 
    navigator.clipboard?.writeText(JSON.stringify(state)).then(()=> showToast('–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–æ')).catch(()=> showToast('–û—à–∏–±–∫–∞ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è')); 
  }catch(e){ 
    showToast('–û—à–∏–±–∫–∞'); 
  } 
};
importBtn.onclick = ()=>{ 
  const s = prompt('–í—Å—Ç–∞–≤—å—Ç–µ JSON —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è:'); 
  try{ 
    const parsed = JSON.parse(s); 
    state = {...deepClone(defaultState), ...parsed}; 
    saveState(); 
    renderAll(); 
    ensureAuto(); 
    showFeed('–ò–º–ø–æ—Ä—Ç –∑–∞–≤–µ—Ä—à—ë–Ω'); 
  }catch(e){ 
    showToast('–ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π JSON'); 
  } 
};
resetBtn.onclick = ()=>{ 
  if(confirm('–°–±—Ä–æ—Å–∏—Ç—å –ø—Ä–æ–≥—Ä–µ—Å—Å?')){ 
    localStorage.removeItem(STORAGE_KEY); 
    state = deepClone(defaultState); 
    saveState(); 
    renderAll(); 
    ensureAuto(); 
    showFeed('–ü—Ä–æ–≥—Ä–µ—Å—Å —Å–±—Ä–æ—à–µ–Ω'); 
  } 
};

// ---------- ensure quest exists ----------
if(!state.quest || !state.quest.id){ 
  state.quest = { id:'q'+Date.now(), type:'clicks', progress:0, goal:10, reward:15 }; 
  saveState(); 
}

// ---------- Mobile menu handling ----------
function handleMobileMenuOnResize(){
  if(window.innerWidth <= 1000){
    mobileMenuBtn.style.display = 'block';
    sidePanel.classList.remove('open'); // —Å–∫—Ä—ã–≤–∞–µ–º –ø–æ-—É–º–æ–ª—á–∞–Ω–∏—é
    document.body.classList.remove('mobile-open');
  } else {
    mobileMenuBtn.style.display = 'none';
    sidePanel.classList.add('open'); // –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –Ω–∞ –¥–µ—Å–∫—Ç–æ–ø–µ
    document.body.classList.remove('mobile-open');
  }
}
mobileMenuBtn.onclick = ()=>{
  const isOpen = sidePanel.classList.toggle('open');
  if(isOpen) document.body.classList.add('mobile-open'); else document.body.classList.remove('mobile-open');
};
window.addEventListener('resize', handleMobileMenuOnResize);
handleMobileMenuOnResize(); // initial

// ---------- Boot ----------
renderAll(); 
ensureAuto(); 
showFeed('–ò–≥—Ä–∞ –∑–∞–≥—Ä—É–∂–µ–Ω–∞ ‚Äî –≥–æ—Ç–æ–≤ –∫ —ç–ø–∏—á–µ—Å–∫–∏–º –ø–æ–∫—É–ø–∫–∞–º!');
</script>
</body>
</html>
